<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Python Packaging: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css">
<script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/incubator/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicons/incubator/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicons/incubator/favicon-16x16.png">
<link rel="manifest" href="favicons/incubator/site.webmanifest">
<link rel="mask-icon" href="favicons/incubator/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/aio.html';">Instructor View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Python Packaging
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Python Packaging
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"></ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Python Packaging
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/aio.html">Instructor View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-scripts-and-modules.html">1. Python Scripts and Modules</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-packages.html">2. From Modules to Packages</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-building-and-installing.html">3. Building and Installing Packages using hatch</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-publishing.html">4. Publishing our Python Packages</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>

                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-01-scripts-and-modules"><p>Content from <a href="01-scripts-and-modules.html">Python Scripts and Modules</a></p>
<hr>
<p>Last updated on 2024-12-10 |

        <a href="https://github.com/carpentries-incubator/python_packaging/edit/main/episodes/01-scripts-and-modules.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is a ‘module’ in Python? How does this differ from a
‘script’?</li>
<li>What are the benefits of modularising our Python code?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Introduce the example library used in this lesson.</li>
<li>Understand the limitations of scripts.</li>
<li>Understand what happens when we <code>import</code> something.</li>
<li>Learn how to convert a simple script into a reusable module.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="python-as-a-scripting-language">Python as a Scripting Language<a class="anchor" aria-label="anchor" href="#python-as-a-scripting-language"></a>
</h2>
<hr class="half-width">
<p>Python is frequently used as a <em>scripting language</em> by
scientists and engineers due to its expressiveness, simplicity, and its
rich ecosystem of third-party libraries. There isn’t a hard line between
a scripting language and a non-scripting language, but some differences
include:</p>
<ul>
<li>Scripts are not compiled to an executable or library object (such as
<code>.so</code> or <code>.dll</code>) before use, and are instead
<em>interpreted</em> directly from the source code. A non-scripting
language, such as C++, must be compiled to machine code before it can be
used.</li>
<li>Scripts must be run using some other compiled program, such as
<code>python</code> or <code>bash</code>.</li>
<li>Scripts are typically short programs that leverage the power of
complex libraries to accomplish some task. They focus more on gluing
together existing tools than performing their own low-level
computations.</li>
</ul>
<p>Python is a very general-purpose language, and it meets the criteria
of both a scripting language and a non-scripting language depending on
how we choose to use it:</p>
<ul>
<li>Python can be run as an interactive session simply by calling
<code>python</code> at the command line. This is typical of a scripting
language.</li>
<li>It is possible to write a linear series of Python expressions in a
file, and run this using the Python interpretter –again, like a
scripting language.</li>
<li>Python code can be bundled in <em>modules</em> and <em>packages</em>
which can then be <code>import</code>-ed into other Python
programs/scripts. These are typically pre-compiled into ‘bytecode’ to
improve performance. This is closer to the behaviour of a fully compiled
language.</li>
</ul>
<p>Typically, a Python project will begin as something that is
inarguably a ‘script’, but as it develops it will take on the character
of a ‘program’. A single file containing a linear series of commands may
develop into a <em>module</em> of reusable functions, and this may
develop further into a <em>package</em> of related modules. Developing
our software in this way allows our programs to grow in complexity in a
much more sustainable manner, and grants much more flexibility to how
users can interact with our code.</p>
<p>Throughout this course, we’ll develop an example library that might
be used for epidemiology modelling, though it isn’t necessary to
understand how this works in order to follow the course. We’ll begin
where many new Python projects start: with a simple script. This one
solves a SIR model, which models the number of Susceptible, Infected,
and Recovered individuals as a pathogen spreads through a population.
The general pattern of the code – set up inputs, solve a problem, plot
the results – should be familiar to those working in a data-oriented
field. It uses the popular plotting library <a href="https://matplotlib.org/stable/tutorials/index.html" class="external-link">Matplotlib</a>
to generate a figure.</p>

<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co"># Inputs</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># Total number of susceptible people at the start of an outbreak</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>pop_size <span class="op">=</span> <span class="dv">8000000</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co"># Average no. of new infections per infected person per day</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>beta <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co"># Inverse of the average number of days taken to recover</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>gamma <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co"># Number of days to run the simulation for</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>days <span class="op">=</span> <span class="dv">150</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co"># Number of infected people at the start of the simulation</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>I_0 <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="co"># Initialise data</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>S <span class="op">=</span> [] <span class="co"># Number of susceptible people each day</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>I <span class="op">=</span> [] <span class="co"># Number of infected people each day</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>R <span class="op">=</span> [] <span class="co"># Number of recovered people each day</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>S.append(pop_size <span class="op">-</span> I_0)</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>I.append(I_0)</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>R.append(<span class="dv">0</span>)</span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a><span class="co"># Solve model</span></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(days):</span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>    <span class="co"># Get rate of change of S, I, and R</span></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>    dS <span class="op">=</span> <span class="op">-</span> beta <span class="op">*</span> S[i] <span class="op">*</span> I[i] <span class="op">/</span> pop_size</span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a>    dR <span class="op">=</span> gamma <span class="op">*</span> I[i]</span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a>    dI <span class="op">=</span> <span class="op">-</span>(dS <span class="op">+</span> dR)</span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a>    <span class="co"># Get values on next day</span></span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a>    S.append(S[i] <span class="op">+</span> dS)</span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a>    I.append(I[i] <span class="op">+</span> dI)</span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a>    R.append(R[i] <span class="op">+</span> dR)</span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a><span class="co"># Plot results</span></span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a>plt.plot(<span class="bu">range</span>(<span class="bu">len</span>(S)), S, label<span class="op">=</span><span class="st">"S"</span>)</span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a>plt.plot(<span class="bu">range</span>(<span class="bu">len</span>(I)), I, label<span class="op">=</span><span class="st">"I"</span>)</span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a>plt.plot(<span class="bu">range</span>(<span class="bu">len</span>(R)), R, label<span class="op">=</span><span class="st">"R"</span>)</span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a>plt.xlabel(<span class="st">"Time /days"</span>)</span>
<span id="cb1-39"><a href="#cb1-39" tabindex="-1"></a>plt.ylabel(<span class="st">"Population"</span>)</span>
<span id="cb1-40"><a href="#cb1-40" tabindex="-1"></a>plt.legend()</span>
<span id="cb1-41"><a href="#cb1-41" tabindex="-1"></a>plt.show()</span></code></pre>
</div>
<p>If we save this script to the file <code>SIR_model_script.py</code>,
it can then be run from the command line as follows:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">$</span> python3 SIR_model_script.py</span></code></pre>
</div>
<p>If everything works as expected, it should produce the following
result:</p>
<figure><img src="fig/SIR_model.png" alt="A plot generated by running the SIR model script" class="figure mx-auto d-block"><div class="figcaption">SIR model results</div>
</figure><p>So far so good, but there are some limitations to this coding
style.</p>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Can you think of any drawbacks to writing scripts like the one shown
above? Think about the general structure of the code and how the user
interacts with it rather than the details of the implementation.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>There are many possible answers to this. Here are some examples:</p>
<ul>
<li>If the user wants to change the model inputs, they have to open the
script file and modify some lines of code before running again. This is
difficult to automate and it’s possible that the user might overwrite
something they didn’t intend to.</li>
<li>If we wish to expand on this functionality or do something different
with the output data, we must either overwrite our original script, or
copy the code across to a new scipt. If we choose to copy the script, it
would take a lot of effort to update all versions every time we wish to
adjust the core routine, and this is likely to introduce bugs.</li>
<li>The user must know where the script is stored on their system,
navigate to that directory, and call it from there. This makes it
challenging to string scripts together to make more complex
programs.</li>
</ul>
</div>
</div>
</div>
</div>
<p>It’s important to note that there’s nothing strictly <em>wrong</em>
with writing scripts in this way, and it’s often a good starting point
for a new project. However, as we develop our project further, we might
find it useful to bundle up the reusable bits of our code into a
<em>module</em> that we can <code>import</code> from other Python
programs, just as we <code>import</code>-ed Matplotlib in our own
script.</p>
</section><section><h2 class="section-heading" id="what-is-a-module">What is a ‘Module’?<a class="anchor" aria-label="anchor" href="#what-is-a-module"></a>
</h2>
<hr class="half-width">
<p>A <em>module</em> is simply any file containing Python statements,
so, technically, the script we defined above is already a module. The
name of a module is the same as the file name, only without the
<code>.py</code> extension. If we were to open a new Python interpretter
session and call the following:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> SIR_model_script</span></code></pre>
</div>
<p>then the script would run as if we’d run it from the command line.
However, the variables we defined in the script will be accessible
within the <em>namespace</em> <code>SIR_model_script</code>:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> SIR_model_script</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">print</span>(SIR_model_script.S)</span></code></pre>
</div>
<p>The current namespace includes all of the objects defined in our
interpretter session, plus all built-in Python functions and types. When
we <code>import</code> our script, we add the name of the script to the
current namespace, but not the variables defined within it; those are
defined within the <em>scope</em> of <code>SIR_model_script</code>, and
are only accessible using the dot operator. If we wanted to bring
everything within the script to the current namespace, but not the
module itself, we can instead call:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> SIR_model_script <span class="im">import</span> <span class="op">*</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">print</span>(S)</span></code></pre>
</div>
<p>Alternatively, if we only want a few objects brought into the current
namespace, we can use:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> SIR_model_script <span class="im">import</span> S, I, R</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">print</span>(S, I, R)</span></code></pre>
</div>
<div id="the-dangers-of-from-module-import" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="the-dangers-of-from-module-import" class="callout-inner">
<h3 class="callout-title">The dangers of
<code>from module import *</code>
</h3>
<div class="callout-content">
<p>Using <code>from module import *</code> is considered harmful by many
developers, as objects can be unintentionally overwritten if there are
any name clashes between modules. It can also make it difficult for
people reading you code to tell which modules your functions and classes
have come from. In general, it’s better to be explicit about what you’re
<code>import</code>-ing.</p>
</div>
</div>
</div>
<p>It is also possible to assign an alias to a module name using the
<code>as</code> keyword:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> SIR_model_script <span class="im">as</span> script</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">print</span>(<span class="bu">type</span>(script.S))</span></code></pre>
</div>
<p>Something to note about <code>import</code> is that it runs the code
found within the module only the first time it is imported, so if we
were to import our script multiple times, it would only create a plot
once.</p>
<p>While we’ve shown that our script is importable, so far it doesn’t
seem to provide many advantages over simply running it on the command
line. The next section will explain what features can make a module more
versatile and useful.</p>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Let’s save the following code in the file
<code>my_module.py</code>:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">10</span></span></code></pre>
</div>
<p>Then we open an interpetter and call the following:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> my_module</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> my_module.x <span class="op">+=</span> <span class="dv">5</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> my_module</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">print</span>(my_module.x)</span></code></pre>
</div>
<p>What is the result?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>The result is <code>15</code>, as the second import does not run the
code in <code>my_module.py</code>, and therefore
<code>my_module.x</code> is not reset back to <code>10</code>.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="making-a-reusable-module">Making a Reusable Module<a class="anchor" aria-label="anchor" href="#making-a-reusable-module"></a>
</h2>
<hr class="half-width">
<p>A good Python module will tend to do the following:</p>
<ul>
<li>Define functions, classes and constants that the user might want to
use.</li>
<li>Not rely on global variables (those defined within the module but
not inside of functions/classes), except in a few scenarios where it
only makes sense for a single instance of the an object to exist.</li>
<li>Avoid performing runtime calculations at the <code>import</code>
stage.</li>
</ul>
<p>Most Python modules shouldn’t do anything if we try to run them from
the command line, and instead they should provide
<code>import</code>-able tools that can be used in the Python
interpretter, by other Python modules, or by dedicated scripts. We’ll
see later how to write a reusable Python module that doubles as a
runnable script.</p>
<p>Most scripts can be converted into reusable modules using the
following steps:</p>
<ul>
<li>Identify each major stage of our data processing. Examples may
include reading in data, running a model, processing results, creating
plots, etc.</li>
<li>For each stage, identify what data is an <em>input</em>, and what is
an <em>output</em>.</li>
<li>Bundle each processing stage into a function that takes the input
data as arguments and returns the output data.</li>
</ul>
<p>For example, the script <code>SIR_model_script</code> has two stages
that can be bundled into functions. The first stage runs the SIR model,
and it takes the following input parameters:</p>
<table class="table">
<colgroup>
<col width="12%">
<col width="8%">
<col width="78%">
</colgroup>
<thead><tr class="header">
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>pop_size</code></td>
<td><code>int</code></td>
<td>Total number of susceptible people at the start of an outbreak</td>
</tr>
<tr class="even">
<td><code>beta</code></td>
<td><code>float</code></td>
<td>Average no. of new infections per infected person per day</td>
</tr>
<tr class="odd">
<td><code>gamma</code></td>
<td><code>float</code></td>
<td>Inverse of the average number of days taken to recover</td>
</tr>
<tr class="even">
<td><code>days</code></td>
<td><code>int</code></td>
<td>Number of days to run the simulation for</td>
</tr>
<tr class="odd">
<td><code>I_0</code></td>
<td><code>int</code></td>
<td>Number of infected people at the start of the simulation</td>
</tr>
</tbody>
</table>
<p>The output data from this stage is:</p>
<table class="table">
<thead><tr class="header">
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>S</code></td>
<td><code>List[float]</code></td>
<td>Number of susceptible people each day</td>
</tr>
<tr class="even">
<td><code>I</code></td>
<td><code>List[float]</code></td>
<td>Number of infected people each day</td>
</tr>
<tr class="odd">
<td><code>R</code></td>
<td><code>List[float]</code></td>
<td>Number of recovered people each day</td>
</tr>
</tbody>
</table>
<p>We can therefore bundle this portion of the script into the function
<code>SIR_model</code>:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="kw">def</span> SIR_model(pop_size, beta, gamma, days, I_0):</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="co">    Solves a SIR model numerically using a simple integration scheme.</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">    pop_size: int</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">        Total number of susceptible people at the start of an outbreak.</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">    beta: float</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">        Average number of new infections per infected person per day.</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">    gamma: float</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">        Inverse of the average number of days taken to recover.</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">    days: int</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">        Number of days to run the simulation for.     </span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co">    I_0: int</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co">        Number of infected people at the start of the simulation.</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a><span class="co">    S: List[float]</span></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a><span class="co">        Number of susceptible people on each day.</span></span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a><span class="co">    I: List[float]</span></span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a><span class="co">        Number of infected people on each day.</span></span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a><span class="co">    R: List[float]</span></span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a><span class="co">        Number of recovered people on each day.</span></span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a>    <span class="co"># Initialise data</span></span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a>    S <span class="op">=</span> [] <span class="co"># Number of susceptible people each day</span></span>
<span id="cb10-29"><a href="#cb10-29" tabindex="-1"></a>    I <span class="op">=</span> [] <span class="co"># Number of infected people each day</span></span>
<span id="cb10-30"><a href="#cb10-30" tabindex="-1"></a>    R <span class="op">=</span> [] <span class="co"># Number of recovered people each day</span></span>
<span id="cb10-31"><a href="#cb10-31" tabindex="-1"></a>    S.append(pop_size <span class="op">-</span> I_0)</span>
<span id="cb10-32"><a href="#cb10-32" tabindex="-1"></a>    I.append(I_0)</span>
<span id="cb10-33"><a href="#cb10-33" tabindex="-1"></a>    R.append(<span class="dv">0</span>)</span>
<span id="cb10-34"><a href="#cb10-34" tabindex="-1"></a></span>
<span id="cb10-35"><a href="#cb10-35" tabindex="-1"></a>    <span class="co"># Solve model</span></span>
<span id="cb10-36"><a href="#cb10-36" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(days):</span>
<span id="cb10-37"><a href="#cb10-37" tabindex="-1"></a>        <span class="co"># Get rate of change of S, I, and R</span></span>
<span id="cb10-38"><a href="#cb10-38" tabindex="-1"></a>        dS <span class="op">=</span> <span class="op">-</span> beta <span class="op">*</span> S[i] <span class="op">*</span> I[i] <span class="op">/</span> pop_size</span>
<span id="cb10-39"><a href="#cb10-39" tabindex="-1"></a>        dR <span class="op">=</span> gamma <span class="op">*</span> I[i]</span>
<span id="cb10-40"><a href="#cb10-40" tabindex="-1"></a>        dI <span class="op">=</span> <span class="op">-</span>(dS <span class="op">+</span> dR)</span>
<span id="cb10-41"><a href="#cb10-41" tabindex="-1"></a>        <span class="co"># Get values on next day</span></span>
<span id="cb10-42"><a href="#cb10-42" tabindex="-1"></a>        S.append(S[i] <span class="op">+</span> dS)</span>
<span id="cb10-43"><a href="#cb10-43" tabindex="-1"></a>        I.append(I[i] <span class="op">+</span> dI)</span>
<span id="cb10-44"><a href="#cb10-44" tabindex="-1"></a>        R.append(R[i] <span class="op">+</span> dR)</span>
<span id="cb10-45"><a href="#cb10-45" tabindex="-1"></a></span>
<span id="cb10-46"><a href="#cb10-46" tabindex="-1"></a>    <span class="cf">return</span> S, I, R</span></code></pre>
</div>
<p>Note that we’ve provided a nice docstring, so that users of our
function can understand how to use it. The second stage of our script
takes the results of the SIR model as input data, and produces a plot.
We can therefore bundle the plotting parts of the script as follows:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Note: imports should go at the top of the file</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="kw">def</span> plot_SIR_model(S, I, R):</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co">    Plot the results of a SIR simulation.</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co">    S: List[float]</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">        Number of susceptible people on each day.</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">    I: List[float]</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co">        Number of infected people on each day.</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="co">    R: List[float]</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="co">        Number of recovered people on each day.</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a><span class="co">    None</span></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a>    plt.plot(<span class="bu">range</span>(<span class="bu">len</span>(S)), S, label<span class="op">=</span><span class="st">"S"</span>)</span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a>    plt.plot(<span class="bu">range</span>(<span class="bu">len</span>(I)), I, label<span class="op">=</span><span class="st">"I"</span>)</span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a>    plt.plot(<span class="bu">range</span>(<span class="bu">len</span>(R)), R, label<span class="op">=</span><span class="st">"R"</span>)</span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a>    plt.xlabel(<span class="st">"Time /days"</span>)</span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a>    plt.ylabel(<span class="st">"Population"</span>)</span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a>    plt.legend()</span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a>    plt.show()</span></code></pre>
</div>
<p>If we save the two code blocks above to a file called
<code>SIR_model.py</code>, we can then open up a Python interpreter and
run the following:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> SIR_model <span class="im">import</span> SIR_model, plot_SIR_model</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> S, I, R <span class="op">=</span> SIR_model(</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>        pop_size<span class="op">=</span><span class="dv">8000000</span>, beta<span class="op">=</span><span class="fl">0.5</span>, gamma<span class="op">=</span><span class="fl">0.1</span>, days<span class="op">=</span><span class="dv">150</span>, I_0<span class="op">=</span><span class="dv">10</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>    )</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> plot_SIR_model(S, I, R)</span></code></pre>
</div>
<p>This should give us the same results as when we ran the script
earlier, and we can run the <code>SIR_model</code> function with
different inputs without needing to change the input parameters in the
file itself. The functions in our script are now therefore ‘reusable’,
and can be integrated in other workflows. The nice docstrings we added
can be viewed using the built-in <code>help()</code> function:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">help</span>(SIR_model)</span></code></pre>
</div>
<p>However, the script-like behaviour has been lost:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">$</span> python3 SIR_model.py</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="ex">$</span> <span class="co"># Nothing happens!</span></span></code></pre>
</div>
<p>In the next section, we’ll show how to maintain script-like
behaviour, and write reusable modules in the same file.</p>
</section><section><h2 class="section-heading" id="maintaining-script-like-functionality">Maintaining Script-Like Functionality<a class="anchor" aria-label="anchor" href="#maintaining-script-like-functionality"></a>
</h2>
<hr class="half-width">
<p>If we wish, we can also maintain the script-like behaviour using the
<code>if __name__ == "__main__".py</code> idiom at the bottom of the
file <code>SIR_model.py</code>. Here, we create a special
<code>if</code> block at the bottom of our module, and within this we
call each of our functions in turn, using the outputs of one as inputs
to the next:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># file: SIR_model.py</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co"># Add this after our function definitions</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>    S, I, R <span class="op">=</span> SIR_model(</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>        pop_size<span class="op">=</span><span class="dv">8000000</span>, beta<span class="op">=</span><span class="fl">0.5</span>, gamma<span class="op">=</span><span class="fl">0.1</span>, days<span class="op">=</span><span class="dv">150</span>, I_0<span class="op">=</span><span class="dv">10</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>    )</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>    plot_SIR_model(S, I, R)</span></code></pre>
</div>
<p>With this is place, we can still run the module as if it were a
script:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="ex">$</span> python3 SIR_model.py</span></code></pre>
</div>
<p>However, this section will not run if we <code>import</code> the
file. Let’s break down how this works:</p>
<ul>
<li>Each Python module is automatically assigned a variable
<code>__name__</code>, and this is usually set to the name of the file
without the <code>.py</code> extension.</li>
</ul>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> SIR_model</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">print</span>(SIR_model.<span class="va">__name__</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="st">"SIR_model"</span></span></code></pre>
</div>
<ul>
<li>The exception to the rule is when we run a Python module as a
script. In this case, the top-level file instead has its
<code>__name__</code> variable set to <code>"__main__"</code>.</li>
</ul>
<p>Therefore, the code written under
<code>if __name__ == "__main__"</code> will run if we use the module as
a script, but not if we <code>import</code> the file.</p>
<div id="challenge3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>If we create the the file <code>name_test.py</code>, which contains
only the following line:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="bu">print</span>(<span class="va">__name__</span>)</span></code></pre>
</div>
<p>What happens if we run the following on the command line?</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">$</span> python3 name_test.py</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>It prints <code>"__main__"</code></p>
</div>
</div>
</div>
</div>
<div id="challenge4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<em> (continued)</em>
</h3>
<div class="callout-content">
<p>What if instead we open an interpreter and import it?</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> name_test</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>It prints <code>"name_test"</code></p>
</div>
</div>
</div>
</div>
<p>As we’ll see later, it can also be handy to bundle the contents of
our <code>if __name__ == "__main__"</code> block into a function, as
then we can <code>import</code> that function and access our script-like
behaviour in another way. This function can take any name, but is often
called <code>main</code>:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="co"># file: SIR_model.py</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>    S, I, R <span class="op">=</span> SIR_model(</span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>        pop_size<span class="op">=</span><span class="dv">8000000</span>, beta<span class="op">=</span><span class="fl">0.5</span>, gamma<span class="op">=</span><span class="fl">0.1</span>, days<span class="op">=</span><span class="dv">150</span>, I_0<span class="op">=</span><span class="dv">10</span></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>    )</span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>    plot_SIR_model(S, I, R)</span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a>    main()</span></code></pre>
</div>
<p>We’ll use this format later when discussing ways to make runnable
<em>packages</em>.</p>
</section><section><h2 class="section-heading" id="managing-pythonpath">Managing PYTHONPATH<a class="anchor" aria-label="anchor" href="#managing-pythonpath"></a>
</h2>
<hr class="half-width">
<p>Our script is now <code>import</code>-able, so the
<code>SIR_model</code> function can be used from any other Python
script, module, or interpretter session. However, we still need to know
where the module is stored on our file system, which can make it
difficult to reuse the functions in a separate project. A simple
solution is to set the <code>PYTHONPATH</code> environment variable on
our system. On Linux machines, this can be achieved using:</p>
<p>TODO: Add an example here where we change dir and then try to import
a module. This will fail without setting python path.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="ex">$</span> export PYTHONPATH=<span class="st">"</span><span class="va">${PYTHONPATH}</span><span class="st">:/path/to/my/module/directory"</span></span></code></pre>
</div>
<p>If you want this to be set every time you open a terminal, you can
add the line to the file <code>~/.bashrc</code>.</p>
<!-- TODO: include Windows explanation -->
<p>However, this is not recommended as a long-term solution, as a custom
<code>PYTHONPATH</code> can cause dependency conflicts between different
packages on our system and can be difficult to debug. In a later
chapter, we will show how to install our own modules using the
<code>pip</code> package manager, which gives us much more control over
how we integrate our modules into our Python environments (which may be
managed using tools such as <code>venv</code> or <code>conda</code>),
and also allows us to install packages from a remote repository. We’ll
also show how to upload our own packages to the remote repository PyPI,
and therefore allow others to download and install our code from the
command line!</p>
</section><section><h2 class="section-heading" id="extra-better-automation-with-matplotlib">Extra: Better Automation with Matplotlib<a class="anchor" aria-label="anchor" href="#extra-better-automation-with-matplotlib"></a>
</h2>
<hr class="half-width">
<p>Earlier, we converted the plotting section of our script into a
function that the user can call. There are two issues with the
implementation as it stands:</p>
<ul>
<li>The use of <code>plt.show()</code> interrupts the flow of the
program and requires the user to manually save the figure or discard it.
This makes it difficult to automate the production of figures.</li>
<li>As it calls <code>plt.plot()</code> without first creating a new
figure, it may interfere with our user’s Matplotlib code.</li>
</ul>
<p>We can improve the function with a few changes:</p>
<ul>
<li>Rather than using Matplotlib’s ‘implicit’ API (such as by using
<code>plt.plot()</code>), which manages global Matplotlib objects, use
the ‘explicit’ API, sometimes called the ‘object-oriented’ API. This
requires handling <code>Figure</code> and <code>Axes</code> objects
directly.</li>
<li>Optionally take in an <code>Axes</code> object. This way, the user
can choose to set up their own <code>Figure</code> and
<code>Axes</code>, and our function can write to it.</li>
<li>Return the <code>Axes</code> object that we worked on, so that the
user can make further changes if they wish.</li>
<li>Only use <code>plt.show()</code> if the user requests it. Also
provide an option to save the figure.</li>
</ul>
<p>Here is an example of an improved function:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a><span class="kw">def</span> plot_SIR_model(S, I, R, ax<span class="op">=</span><span class="va">None</span>, save_to<span class="op">=</span><span class="va">None</span>, show<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a><span class="co">    Plot the results of a SIR simulation.</span></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a><span class="co">    S: List[float]</span></span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a><span class="co">        Number of susceptible people on each day.</span></span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a><span class="co">    I: List[float]</span></span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a><span class="co">        Number of infected people on each day.</span></span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a><span class="co">    R: List[float]</span></span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a><span class="co">        Number of recovered people on each day.</span></span>
<span id="cb24-15"><a href="#cb24-15" tabindex="-1"></a><span class="co">    ax: Optional[plt.Axes], default None</span></span>
<span id="cb24-16"><a href="#cb24-16" tabindex="-1"></a><span class="co">        Axes object on which to create the plot.</span></span>
<span id="cb24-17"><a href="#cb24-17" tabindex="-1"></a><span class="co">        A new Axes is created if this is None.</span></span>
<span id="cb24-18"><a href="#cb24-18" tabindex="-1"></a><span class="co">    save_to: Optional[str], default None</span></span>
<span id="cb24-19"><a href="#cb24-19" tabindex="-1"></a><span class="co">        Name of the file to save the plot to.</span></span>
<span id="cb24-20"><a href="#cb24-20" tabindex="-1"></a><span class="co">        Does not save if None.</span></span>
<span id="cb24-21"><a href="#cb24-21" tabindex="-1"></a><span class="co">    show: bool, default False</span></span>
<span id="cb24-22"><a href="#cb24-22" tabindex="-1"></a><span class="co">        If True, call plt.show() on completion.</span></span>
<span id="cb24-23"><a href="#cb24-23" tabindex="-1"></a></span>
<span id="cb24-24"><a href="#cb24-24" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb24-25"><a href="#cb24-25" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb24-26"><a href="#cb24-26" tabindex="-1"></a><span class="co">    plt.Axes</span></span>
<span id="cb24-27"><a href="#cb24-27" tabindex="-1"></a><span class="co">        The axes object the results have been plotted to.</span></span>
<span id="cb24-28"><a href="#cb24-28" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb24-29"><a href="#cb24-29" tabindex="-1"></a>    <span class="co"># Use plt.subplots to create Figure and Axes objects</span></span>
<span id="cb24-30"><a href="#cb24-30" tabindex="-1"></a>    <span class="co"># if one is not provided.</span></span>
<span id="cb24-31"><a href="#cb24-31" tabindex="-1"></a>    <span class="cf">if</span> ax <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb24-32"><a href="#cb24-32" tabindex="-1"></a>        fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb24-33"><a href="#cb24-33" tabindex="-1"></a></span>
<span id="cb24-34"><a href="#cb24-34" tabindex="-1"></a>    <span class="co"># Create plot</span></span>
<span id="cb24-35"><a href="#cb24-35" tabindex="-1"></a>    ax.plot(<span class="bu">range</span>(<span class="bu">len</span>(S)), S, label<span class="op">=</span><span class="st">"S"</span>)</span>
<span id="cb24-36"><a href="#cb24-36" tabindex="-1"></a>    ax.plot(<span class="bu">range</span>(<span class="bu">len</span>(I)), I, label<span class="op">=</span><span class="st">"I"</span>)</span>
<span id="cb24-37"><a href="#cb24-37" tabindex="-1"></a>    ax.plot(<span class="bu">range</span>(<span class="bu">len</span>(R)), R, label<span class="op">=</span><span class="st">"R"</span>)</span>
<span id="cb24-38"><a href="#cb24-38" tabindex="-1"></a>    ax.set_xlabel(<span class="st">"Time /days"</span>)</span>
<span id="cb24-39"><a href="#cb24-39" tabindex="-1"></a>    ax.set_ylabel(<span class="st">"Population"</span>)</span>
<span id="cb24-40"><a href="#cb24-40" tabindex="-1"></a>    ax.legend()</span>
<span id="cb24-41"><a href="#cb24-41" tabindex="-1"></a></span>
<span id="cb24-42"><a href="#cb24-42" tabindex="-1"></a>    <span class="co"># Optionally save the figure</span></span>
<span id="cb24-43"><a href="#cb24-43" tabindex="-1"></a>    <span class="cf">if</span> save_to <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb24-44"><a href="#cb24-44" tabindex="-1"></a>        fig <span class="op">=</span> ax.get_figure()</span>
<span id="cb24-45"><a href="#cb24-45" tabindex="-1"></a>        fig.savefig(save_to)</span>
<span id="cb24-46"><a href="#cb24-46" tabindex="-1"></a></span>
<span id="cb24-47"><a href="#cb24-47" tabindex="-1"></a>    <span class="co"># Optionally show the figure</span></span>
<span id="cb24-48"><a href="#cb24-48" tabindex="-1"></a>    <span class="cf">if</span> show:</span>
<span id="cb24-49"><a href="#cb24-49" tabindex="-1"></a>        plt.show()</span>
<span id="cb24-50"><a href="#cb24-50" tabindex="-1"></a></span>
<span id="cb24-51"><a href="#cb24-51" tabindex="-1"></a>    <span class="cf">return</span> ax</span></code></pre>
</div>
<p>This gives our users much more control over how to create plots, and
it allows our function to be used as part of a larger automated pipeline
that runs without needing human input. There are many further ways we
could improve this function and allow our users to finely control what’s
plotted, such as by allowing the user to overwrite axis/line labels or
interact with legend placement, but we’ll move on from this topic for
now.</p>
</section><section><h2 class="section-heading" id="extra-better-scripting-with-argparse">Extra: Better scripting with <code>argparse</code>
<a class="anchor" aria-label="anchor" href="#extra-better-scripting-with-argparse"></a>
</h2>
<hr class="half-width">
<p>TODO: split arg parsing off into a separate episode</p>
<p>We showed earlier how to maintain script-like functionality in our
modules. We’ll update that code to include our updated plotting
function, so we’ll automatically save to a file if the user runs our
script:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="co"># file: SIR_model.py</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>    S, I, R <span class="op">=</span> SIR_model(</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>        pop_size<span class="op">=</span><span class="dv">8000000</span>, beta<span class="op">=</span><span class="fl">0.5</span>, gamma<span class="op">=</span><span class="fl">0.1</span>, days<span class="op">=</span><span class="dv">150</span>, I_0<span class="op">=</span><span class="dv">10</span></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>    )</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>    plot_SIR_model(S, I, R, save_to<span class="op">=</span><span class="st">"SIR_model.png"</span>)</span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>    main()</span></code></pre>
</div>
<p>An issue with our example is that it still requires the user to
manually edit the file if they wish to change the input or outputs. This
problem can be solved by instead taking arguments from the command line.
A simple interface can be created using <code>sys.argv</code>, which is
a list of command line arguments in the form of strings:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="co"># file: SIR_model.py</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>    <span class="co"># Note: sys.argv[0] is the name of our program!</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>    pop_size <span class="op">=</span> <span class="bu">int</span>(sys.argv[<span class="dv">1</span>])</span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>    beta <span class="op">=</span> <span class="bu">float</span>(sys.argv[<span class="dv">2</span>])</span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>    gamma <span class="op">=</span> <span class="bu">float</span>(sys.argv[<span class="dv">3</span>])</span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>    days <span class="op">=</span> <span class="bu">int</span>(sys.argv[<span class="dv">4</span>])</span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>    I_0 <span class="op">=</span> <span class="bu">int</span>(sys.argv[<span class="dv">5</span>])</span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a>    output <span class="op">=</span> sys.argv[<span class="dv">6</span>]</span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a>    S, I, R <span class="op">=</span> SIR_model(</span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a>        pop_size<span class="op">=</span>pop_size,</span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a>        beta<span class="op">=</span>beta,</span>
<span id="cb26-16"><a href="#cb26-16" tabindex="-1"></a>        gamma<span class="op">=</span>gamma,</span>
<span id="cb26-17"><a href="#cb26-17" tabindex="-1"></a>        days<span class="op">=</span>days,</span>
<span id="cb26-18"><a href="#cb26-18" tabindex="-1"></a>        I_0<span class="op">=</span>I_0,</span>
<span id="cb26-19"><a href="#cb26-19" tabindex="-1"></a>    )</span>
<span id="cb26-20"><a href="#cb26-20" tabindex="-1"></a>    plot_SIR_model(S, I, R, save_to<span class="op">=</span>output)</span>
<span id="cb26-21"><a href="#cb26-21" tabindex="-1"></a></span>
<span id="cb26-22"><a href="#cb26-22" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb26-23"><a href="#cb26-23" tabindex="-1"></a>    main()</span></code></pre>
</div>
<p>However, this requires the user to provide every argument in order,
and doesn’t allow default arguments. We can achieve a better interface
using the built-in <code>argparse</code> library. The comments in the
code below explain how this works:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="co"># file: SIR_model.py</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="im">from</span> argparse <span class="im">import</span> ArgumentParser</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>    <span class="co"># Create an argument parser object. We can provide</span></span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a>    <span class="co"># some info about our program here.</span></span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a>    parser <span class="op">=</span> ArgumentParser(</span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a>        prog<span class="op">=</span><span class="st">"SIR_model"</span>,</span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a>        description<span class="op">=</span><span class="st">"Solves SIR model and creates a plot"</span>,</span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a>    )</span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a>    <span class="co"># Add each argument to the parser. We can specify</span></span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a>    <span class="co"># the types of each argument. Optional arguments</span></span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a>    <span class="co"># should have single character names with a hypen,</span></span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a>    <span class="co"># or longer names with a double dash.</span></span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb27-17"><a href="#cb27-17" tabindex="-1"></a>        <span class="st">"-p"</span>, <span class="st">"--pop_size"</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">int</span>, default<span class="op">=</span><span class="dv">10000000</span>,</span>
<span id="cb27-18"><a href="#cb27-18" tabindex="-1"></a>        <span class="bu">help</span><span class="op">=</span><span class="st">"Total population size"</span>,</span>
<span id="cb27-19"><a href="#cb27-19" tabindex="-1"></a>    )</span>
<span id="cb27-20"><a href="#cb27-20" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb27-21"><a href="#cb27-21" tabindex="-1"></a>        <span class="st">"-b"</span>, <span class="st">"--beta"</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">float</span>, default<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb27-22"><a href="#cb27-22" tabindex="-1"></a>        <span class="bu">help</span><span class="op">=</span><span class="st">"Average no. of new infections per infected person per day"</span>,</span>
<span id="cb27-23"><a href="#cb27-23" tabindex="-1"></a>    )</span>
<span id="cb27-24"><a href="#cb27-24" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb27-25"><a href="#cb27-25" tabindex="-1"></a>        <span class="st">"-g"</span>, <span class="st">"--gamma"</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">float</span>, default<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb27-26"><a href="#cb27-26" tabindex="-1"></a>        <span class="bu">help</span><span class="op">=</span><span class="st">"Inverse of average number of days taken to recover"</span>,</span>
<span id="cb27-27"><a href="#cb27-27" tabindex="-1"></a>    )</span>
<span id="cb27-28"><a href="#cb27-28" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb27-29"><a href="#cb27-29" tabindex="-1"></a>        <span class="st">"-d"</span>, <span class="st">"--days"</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">int</span>, default<span class="op">=</span><span class="dv">150</span>,</span>
<span id="cb27-30"><a href="#cb27-30" tabindex="-1"></a>        <span class="bu">help</span><span class="op">=</span><span class="st">"Number of days to run the simulation"</span>,</span>
<span id="cb27-31"><a href="#cb27-31" tabindex="-1"></a>    )</span>
<span id="cb27-32"><a href="#cb27-32" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb27-33"><a href="#cb27-33" tabindex="-1"></a>        <span class="st">"-i"</span>, <span class="st">"--i0"</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">int</span>, default<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb27-34"><a href="#cb27-34" tabindex="-1"></a>        <span class="bu">help</span><span class="op">=</span><span class="st">"Number of infected people at the start of the simulation"</span>,</span>
<span id="cb27-35"><a href="#cb27-35" tabindex="-1"></a>    )</span>
<span id="cb27-36"><a href="#cb27-36" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb27-37"><a href="#cb27-37" tabindex="-1"></a>        <span class="st">"-o"</span>, <span class="st">"--output"</span>, default<span class="op">=</span><span class="st">"SIR_model.png"</span>,</span>
<span id="cb27-38"><a href="#cb27-38" tabindex="-1"></a>        <span class="bu">help</span><span class="op">=</span><span class="st">"Output file to save plot to"</span>,</span>
<span id="cb27-39"><a href="#cb27-39" tabindex="-1"></a>    )</span>
<span id="cb27-40"><a href="#cb27-40" tabindex="-1"></a></span>
<span id="cb27-41"><a href="#cb27-41" tabindex="-1"></a>    <span class="co"># Get each argument from the command line</span></span>
<span id="cb27-42"><a href="#cb27-42" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb27-43"><a href="#cb27-43" tabindex="-1"></a></span>
<span id="cb27-44"><a href="#cb27-44" tabindex="-1"></a>    <span class="co"># Run our code</span></span>
<span id="cb27-45"><a href="#cb27-45" tabindex="-1"></a>    S, I, R <span class="op">=</span> SIR_model(</span>
<span id="cb27-46"><a href="#cb27-46" tabindex="-1"></a>        pop_size<span class="op">=</span>args.pop_size,</span>
<span id="cb27-47"><a href="#cb27-47" tabindex="-1"></a>        beta<span class="op">=</span>args.beta,</span>
<span id="cb27-48"><a href="#cb27-48" tabindex="-1"></a>        gamma<span class="op">=</span>args.gamma,</span>
<span id="cb27-49"><a href="#cb27-49" tabindex="-1"></a>        days<span class="op">=</span>args.days,</span>
<span id="cb27-50"><a href="#cb27-50" tabindex="-1"></a>        I_0<span class="op">=</span>args.i0,</span>
<span id="cb27-51"><a href="#cb27-51" tabindex="-1"></a>    )</span>
<span id="cb27-52"><a href="#cb27-52" tabindex="-1"></a>    plot_SIR_model(S, I, R, save_to<span class="op">=</span>args.output)</span>
<span id="cb27-53"><a href="#cb27-53" tabindex="-1"></a></span>
<span id="cb27-54"><a href="#cb27-54" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb27-55"><a href="#cb27-55" tabindex="-1"></a>    main()</span></code></pre>
</div>
<p>We can now run our script using inputs from the command line:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="ex">$</span> python3 SIR_model.py <span class="at">--pop_size</span><span class="op">=</span>1000 <span class="at">--days</span><span class="op">=</span>10 <span class="at">-o</span> mymodel.png</span></code></pre>
</div>
<p>We defined each option with a default, so we don’t need to provide
all of them if we don’t want to. Each option has a long form with two
dashes (<code>--output</code>, <code>--beta</code>), and a short form
with one dash (<code>-o</code>, <code>-b</code>), which are
interchangeable (if we wish, we could provide only the short form or the
long form). Note that we can use either an equals <code>=</code> or a
space to separate the option name from its value.</p>
<p>If we had provided options without preceeding dashes, they would
become ‘positional’ arguments, and would be required. The order
positional arguments should be supplied is given by the order in which
they are added to the parser. For example, if we had added
<code>beta</code> and <code>gamma</code> as follows:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>        <span class="st">"beta"</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">float</span>,</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>        <span class="bu">help</span><span class="op">=</span><span class="st">"Average no. of new infections per infected person per day"</span>,</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>    )</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>        <span class="st">"gamma"</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">float</span>,</span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>        <span class="bu">help</span><span class="op">=</span><span class="st">"Inverse of average number of days taken to recover"</span>,</span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>    )</span></code></pre>
</div>
<p>We would need to supply these arguments in order when running our
code. Positional arguments are not specified by name on the command
line:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="ex">$</span> python3 SIR_model.py 0.5 0.1 <span class="at">--pop_size</span><span class="op">=</span>1000 <span class="at">--days</span><span class="op">=</span>10 <span class="at">-o</span> mymodel.png</span></code></pre>
</div>
<p>If we forget how our script is supposed to be run,
<code>argparse</code> automatically provides a nice help message if we
run it with <code>-h</code> or <code>--help</code>:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="ex">$</span> python3 SIR_model.py <span class="at">--help</span></span></code></pre>
</div>
<pre class="result"><code>usage: SIR_model [-h] [-p POP_SIZE] [-b BETA] [-g GAMMA] [-d DAYS] [-i I0] [-o OUTPUT]

Solves SIR model and creates a plot

optional arguments:
  -h, --help            show this help message and exit
  -p POP_SIZE, --pop_size POP_SIZE
                        Total population size
  -b BETA, --beta BETA  Average no. of new infections per infected person per day
  -g GAMMA, --gamma GAMMA
                        Inverse of average number of days taken to recover
  -d DAYS, --days DAYS  Number of days to run the simulation
  -i I0, --i0 I0        Number of infected people at the start of the simulation
  -o OUTPUT, --output OUTPUT
                        Output file to save plot to</code></pre>
<p>There are many ways to control our command line interface in more
detail, such as constraining the possible user input choices, parsing
lists of inputs, and using ‘sub-parsers’ to split functionality across a
number of sub-commands, much like how <code>pip</code> handles its many
utilities:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="ex">$</span> pip install <span class="at">--upgrade</span> mypkg myotherpkg</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a><span class="ex">$</span> pip list <span class="at">--exclude</span> numpy</span></code></pre>
</div>
<p>Here, <code>install</code> and <code>list</code> are sub-commands,
which each handle a different set of their own args. We’ll show how to
achieve this in the next lesson, where we’ll expand our code from a
single module to a collection of modules known as a ‘package’.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Any Python file can be considered a ‘module’, and can be
<code>import</code>-ed. This just runs the code in the file, and makes
the names of any objects in the module accessible using
dot-notation.</li>
<li>If we bundle our Python scripts into a collection of functions, we
can reuse those functions in other modules or in the Python
interpretter.</li>
<li>After turning our scripts into reusable modules, we can maintain
script-like behaviour using the idiom
<code>if __name__ == "__main__"</code>.</li>
<li>
<code>argparse</code> can be used to create sophisticated command
line interfaces.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-02-packages"><p>Content from <a href="02-packages.html">From Modules to Packages</a></p>
<hr>
<p>Last updated on 2024-12-10 |

        <a href="https://github.com/carpentries-incubator/python_packaging/edit/main/episodes/02-packages.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is a ‘package’ in Python?</li>
<li>Why should we organise our code into packages?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to group multiple modules into a package.</li>
<li>Understand the purpose of an <code>__init__.py</code> file.</li>
<li>Understand how <code>__all__</code> works.</li>
<li>Understand the purpose of a <code>__main__.py</code> file.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="packages">Packages<a class="anchor" aria-label="anchor" href="#packages"></a>
</h2>
<hr class="half-width">
<p>In the previous lesson, we showed how to convert a simple Python
script into a reusable module by bundling up different parts of the
script into functions. However, as our project grows, we may find it
beneficial to spread the functionality of our project over multiple
files. Separating logically distinct units of code into their own files
will help others to understand how our project works, and it allows us
to control which features of our code are exposed to users at the top
level.</p>
<p>The primary tool for organising a project across multiple files is
the <em>package</em>. Packages are very similar to modules, and they are
defined by the directory structure we use to organise our files.</p>
<p>To demonstrate how to create a package, we’ll convert our SIR model
module from the last lesson into a package. Let’s say we have it stored
within a directory <code>epi_models</code> – short for epidemiology
models:</p>
<p><code> 📁 epi_models<br> |<br> |____📜 SIR.py<br></code></p>
<p>To convert this to a package, we’ll simply create a new directory –
also called <code>epi_models</code> – and move our Python module to
it:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">$</span> cd /path/to/my/workspace/epi_models</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">$</span> mkdir epi_models</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="ex">$</span> mv SIR.py epi_models</span></code></pre>
</div>
<p>We’ll also add a new empty file called <code>__init__.py</code>:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">$</span> touch epi_models/__init__.py</span></code></pre>
</div>
<p>Our directory structure should now be:</p>
<p><code> 📁 epi_models<br> |<br> |____📦 epi_models<br>      |<br>
     |____📜 __init__.py<br>      |____📜 SIR.py<br></code></p>
<p>That’s all we need for a basic package! But why did we need to create
a new directory with the same name, and what is <code>__init__.py</code>
for?</p>
<ul>
<li>The top-level directory can be thought of as the <em>project
directory</em>, while the directory contained within is the <em>package
directory</em>. Later, we will add new files to the project directory
containing descriptive metadata for our package, and this will allow us
to build, install, and publish the package. It is important for these
files to be kept outside of the package itself.</li>
<li>The choice to give the package directory the same name as the
project directory is simply a common convention for Python projects, and
it’ll make it easier for to build, install and publish our package
later. We’ll cover alternative directory layouts in our lesson on <a href="03-building-and-installing.html">building and installing
packages</a>.</li>
<li>The presence of an <code>__init__.py</code> file marks a directory
as a package, and the contents of this file are run when the package or
any modules within are imported. We’ll explain how to use this file to
set up and control our package in a later section.</li>
</ul>
<div id="namespace-packages" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="namespace-packages" class="callout-inner">
<h3 class="callout-title">Namespace Packages</h3>
<div class="callout-content">
<p>Since Python 3.3, if you omit <code>__init__.py</code>, you may find
that the following code snippets continue to work. This is because
directories without <code>__init__.py</code> act as <em>namespace
packages</em>, which can be used to build a package using multiple
‘portions’ spread across your system. The specification for namespace
packages can be found in <a href="https://peps.python.org/pep-0420/" class="external-link">PEP
420</a>.</p>
<p>Unless you’re intending to create a namespace package, it is good
practice to include <code>__init__.py</code>, even if you choose to
leave it empty, as this makes your intentions for the package
clearer.</p>
</div>
</div>
</div>
<p>Now that we’ve created a basic package, it is straightforward to
expand it to contain additional modules. For example, we may choose to
add new epidemiology models, such as the SEIR model which introduces a
new population category of those who are Exposed to a pathogen, but not
yet infectious themselves (this models diseases such as COVID-19 fairly
well). We could also add a SIS model, which is similar to the SIR model,
but Recovered individuals do not gain immunity to the pathogen, and
instead return to the Susceptible population (this can apply to the
common cold and some types of flu). These new modules should be added to
the package directory:</p>
<p>TODO: Scrub unimplemented models to reduce complexity</p>
<p><code> 📁 epi_models<br> |<br> |____📦 epi_models<br>      |<br>
     |____📜 __init__.py<br>      |____📜 SIR.py<br>      |____📜
SEIR.py<br>      |____📜 SIS.py<br></code></p>
<p>These new modules might contain similar functions to
<code>SIR.py</code>. For example, <code>SEIR.py</code> may contain:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># file: SEIR.py</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="kw">def</span> SEIR_model(pop_size, alpha, beta, gamma, days, I_0):</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    <span class="co"># Function to solve the SEIR model</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="co"># Returns lists S, E, I, R</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    <span class="cf">pass</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="kw">def</span> plot_SEIR_model(S, E, I, R):</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>    <span class="co"># Function to plot S, E, I, R over time</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>    <span class="cf">pass</span></span></code></pre>
</div>
<p>We won’t worry about how these functions should be implemented for
now. <code>SIS.py</code> should contain similar functions.</p>
<p>To import our functions, we can now enter the top-level
<code>epi_models</code> directory and call the following in an
interactive session:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> epi_models.SIR</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> S, I, R <span class="op">=</span> epi_models.SIR.SIR_model(</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>        pop_size<span class="op">=</span><span class="dv">8000000</span>, beta<span class="op">=</span><span class="fl">0.5</span>, gamma<span class="op">=</span><span class="fl">0.1</span>, days<span class="op">=</span><span class="dv">150</span>, I_0<span class="op">=</span><span class="dv">10</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    )</span></code></pre>
</div>
<p>Having to type the package name and the module name every time can be
inconvenient, so it’s a good idea to use the alternative
<code>import</code> styles we discussed in the previous lesson:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># Assign an alias to the import</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> epi_models.SEIR <span class="im">as</span> SEIR</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> S, E, I, R <span class="op">=</span> SEIR.SEIR_model(</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>        pop_size<span class="op">=</span><span class="dv">8000000</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, beta<span class="op">=</span><span class="fl">0.5</span>, gamma<span class="op">=</span><span class="fl">0.1</span>, days<span class="op">=</span><span class="dv">150</span>, I_0<span class="op">=</span><span class="dv">10</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>    )</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># Use 'from ... import ...' to get the function directly</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> epi_models.SEIR <span class="im">import</span> SEIR_model</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> S, E, I, R <span class="op">=</span> SEIR_model(</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>        pop_size<span class="op">=</span><span class="dv">8000000</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, beta<span class="op">=</span><span class="fl">0.5</span>, gamma<span class="op">=</span><span class="fl">0.1</span>, days<span class="op">=</span><span class="dv">150</span>, I_0<span class="op">=</span><span class="dv">10</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>    )</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># Import everything into the current namespace (not recommended!)</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> epi_models.SIS <span class="im">import</span> <span class="op">*</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> S, E, I, R <span class="op">=</span> SEIR_model(</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>        pop_size<span class="op">=</span><span class="dv">8000000</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, beta<span class="op">=</span><span class="fl">0.5</span>, gamma<span class="op">=</span><span class="fl">0.1</span>, days<span class="op">=</span><span class="dv">150</span>, I_0<span class="op">=</span><span class="dv">10</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>    )</span></code></pre>
</div>
<p>As our project develops, we may decide that we need a further level
of organisation. For example, if our modelling tools and our plotting
tools become sufficently complex, we may decide to move these into their
own directories. To do this, we can define <em>sub-packages</em> within
our top-level package:</p>
<p><code> 📁 epi_models<br> |<br> |____📦 epi_models<br>      |<br>
     |____📜 __init__.py<br>      |<br>      |____📁 models<br>
     |    |<br>      |    |____📜 __init__.py<br>      |    |____📜
SIR.py<br>      |    |____📜 SEIR.py<br>      |    |____📜 SIS.py<br>
     |<br>      |____📁 plotting<br>           |<br>           |____📜
__init__.py<br>           |____📜 plot_SIR.py<br>           |____📜
plot_SEIR.py<br>           |____📜 plot_SIS.py<br></code></p>
<p>Note that each sub-directory, and hence sub-package, requires its own
<code>__init__.py</code>. With our project organised in this way, we can
now import each function using:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> epi_models.models.SIR <span class="im">as</span> SIR</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># Alternatively, get a single function instead of a whole module:</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> epi_models.plotting.plot_SEIR <span class="im">import</span> plot_SEIR_model</span></code></pre>
</div>
</section><section><h2 class="section-heading" id="relative-imports">Relative Imports<a class="anchor" aria-label="anchor" href="#relative-imports"></a>
</h2>
<hr class="half-width">
<p>One advantage of organising our code into packages and sub-packages
is that it allows us to import other modules using <em>relative
imports</em>. To show how these work, we’ll add an extra file
<code>utils.py</code> inside the <code>models</code> subpackage.</p>
<p><code> 📁 epi_models<br> |<br> |____📦 epi_models<br>      |<br>
     |____📜 __init__.py<br>      |<br>      |____📁 models<br>
     |    |<br>      |    |____📜 __init__.py<br>      |    |____📜
SIR.py<br>      |    |____📜 SEIR.py<br>      |    |____📜 SIS.py<br>
     |    |____📜 utils.py<br>      |<br>      |____📁 plotting<br>
          |<br>           |____📜 __init__.py<br>           |____📜
plot_SIR.py<br>           |____📜 plot_SEIR.py<br>           |____📜
plot_SIS.py<br></code></p>
<p>This could contain utility functions that may be useful within
<code>SIR.py</code>, <code>SEIR.py</code>, and <code>SIS.py</code>. In
each of these files, we could import the function <code>some_func</code>
from <code>utils.py</code> using the following syntax:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="im">from</span> .utils <span class="im">import</span> some_func</span></code></pre>
</div>
<p>The dot preceding the module name instructs Python to search inside
the current (sub-)package to find a module with a matching name.</p>
<p>We may also find it useful for our plotting tools to have access to
the modelling functions. In that case, we can add the following to
<code>plot_SIR.py</code>:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="im">from</span> ..models.SIR <span class="im">import</span> SIR_model</span></code></pre>
</div>
<p>Here, the double dots indicate that we should look one package higher
than the current sub-package.</p>
<p>Note that relative imports only work within packages, so they should
be avoided in our plain scripts.</p>
</section><section><h2 class="section-heading" id="the-__init__-py-file">The <code>__init__.py</code> file<a class="anchor" aria-label="anchor" href="#the-__init__-py-file"></a>
</h2>
<hr class="half-width">
<p><code>__init__.py</code> files do not need to contain any code to
mark a directory as a Python package, but if we wish, we can use them to
control what is or isn’t visible at package-level scope, or to perform
any additional setup.</p>
<p>TODO: This needs an interactive exercise. What happens without
importing anything in <strong>init</strong>?</p>
<p>Consider the <code>__init__.py</code> file in the <code>models</code>
directory. Let’s add the following lines:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># file: epi_models/models/__init__.py</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="im">from</span> .SIR <span class="im">import</span> SIR_model</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="im">from</span> .SEIR <span class="im">import</span> SEIR_model</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="im">from</span> .SIS <span class="im">import</span> SIS_model</span></code></pre>
</div>
<p>When <code>SIR_model</code>, <code>SEIR_model</code> and
<code>SIS_model</code> are brought into the local namespace in
<code>models/__init__.py</code>, they are brought into the namespace of
<code>epi_models.models</code> too:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> epi_models.models <span class="im">import</span> SIR_model</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># Equivalent to:</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> epi_models.models.SIR <span class="im">import</span> SIR_model</span></code></pre>
</div>
<p>If we wish to expose these functions to the user at the top level
package, we can also add the following to
<code>epi_models/__init__.py</code></p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># file: epi_models/__init__.py</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="im">from</span> .models <span class="im">import</span> SIR_model, SEIR_model, SIS_model</span></code></pre>
</div>
<p>Note that we can import these names directly from the
<code>models</code> sub-package instead of going to each of the modules
in turn. It is now much easier for users to access these functions:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> epi_models <span class="im">import</span> SIR_model</span></code></pre>
</div>
<p>When writing <code>__init__.py</code> files, it is important to
consider what we <em>don’t</em> import. Note that we did not import any
functions from <code>utils.py</code>, as these are only intended for use
within the <code>models</code> sub-package, and there’s no need to
expose these implementation details to the user. A well crafted
<code>__init__.py</code> allows us to define a <em>public API</em>,
which is the portion of our code that we expect our users to interact
with. The following section introduces the <code>__all__</code>
variable, which allows us to more rigorously define a public API.</p>
<p>As the contents of <code>__init__.py</code> is run whenever the
package or any sub-packages/modules are imported, we can also use
<code>__init__.py</code> to perform any additional package-level setup.
For instance, it might be used to set up connection to a database used
throughout the package. In this way, <code>__init__.py</code> performs a
similar role for a package as an <code>__init__</code> function does for
a class.</p>
</section><section><h2 class="section-heading" id="using-__all__-to-control-from-module-import">Using <code>__all__</code> to control
<code>from module import *</code>
<a class="anchor" aria-label="anchor" href="#using-__all__-to-control-from-module-import"></a>
</h2>
<hr class="half-width">
<p><code>__all__</code> is an optional variable that we may set in our
modules and packages (to assign it to a package, it should be defined in
<code>__init__.py</code>). It should be a list of strings matching the
names of all objects – including functions, classes, constants and
variables – that we wish to be considered ‘public’ features that the
user may wish to use.</p>
<p><code>__all__</code> also changes the behaviour of
<code>from module import *</code>. By default, this would import all
objects within the namespace of <code>module</code>, and bring them into
the current namespace. This may not be desirable, as this may bring
utility functions/classes/variables into the current scope, including
any objects we explicitly mark as private using a preceeding underscore,
and even anything we’ve imported. If we set <code>__all__</code>, only
those objects with names matching the strings contained within
<code>__all__</code> will be loaded. For example, if we wrote the
following:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># file: epi_models/__init__.py</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="im">from</span> .models <span class="im">import</span> SIR_model, SEIR_model, SIS_model</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>__all__ <span class="op">=</span> [<span class="st">"SIR_model"</span>, <span class="st">"SEIR_model"</span>] <span class="co"># Note SIS_model is missing!</span></span></code></pre>
</div>
<p>Calling the following in an interactive session would work just
fine:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> epi_models <span class="im">import</span> <span class="op">*</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> SIR_model</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;function SIR_model at 0x7f0290dc9150&gt;</code></pre>
</div>
<p>However, the following would fail:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> SIS_model</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
NameError: name 'SIS_model' is not defined</code></pre>
</div>
<p>TODO: remove discussion of private variables ::::::::::::::::::::::
discussion</p>
<div class="section level3">
<h3 id="private-variables-in-python">‘Private’ variables in Python<a class="anchor" aria-label="anchor" href="#private-variables-in-python"></a>
</h3>
<p>It is common for Python programmers to mark objects as private by
prefixing their names with an underscore. For example,
<code>_private_variable</code> or <code>_PrivateClass</code>. For an
added layer of protection, variables set in class instances with two
underscores, such as <code>self.__x</code>, will have their names
mangled when viewed from outside the class, but they will still be
locatable and modifiable by a determined individual.</p>
<p>Python programmers will also sometimes use a <em>trailing</em>
underscore, and this is commonly used to avoid a name clash with a
built-in object:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="kw">lambda</span> <span class="op">=</span> <span class="dv">10</span> <span class="co"># Fails! Raises SyntaxError</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> lambda_ <span class="op">=</span> <span class="dv">10</span> <span class="co"># Works just fine</span></span></code></pre>
</div>
<p>A combination of the private naming convention, well chosen
<code>__all__</code> variables, and thorough documentation is more than
sufficient to specify a public API.</p>
<p>::::::::::::::::::::::::::::::</p>
</div>
</section><section><h2 class="section-heading" id="script-like-packages-and-the-__main__-py-file">Script-like Packages and the <code>__main__.py</code> file<a class="anchor" aria-label="anchor" href="#script-like-packages-and-the-__main__-py-file"></a>
</h2>
<hr class="half-width">
<p>In the previous lesson, we introduced the
<code>if __name__ == "__main__"</code> idiom, and discussed how to use
this to maintain script-like behaviour in our reusable modules. The good
news is that this is still possible when we upgrade our modules to
packages. For instance, let’s say that the file
<code>epi_models/plotting/plot_SIR</code> contains the following, which
excludes the enhancements added in the ‘extra’ section last lesson:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># file: plot_SIR.py</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="kw">def</span> plot_SIR_model(S, I, R):</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co">    Plot the results of a SIR simulation.</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a><span class="co">    S: List[float]</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a><span class="co">        Number of susceptible people on each day.</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="co">    I: List[float]</span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a><span class="co">        Number of infected people on each day.</span></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a><span class="co">    R: List[float]</span></span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a><span class="co">        Number of recovered people on each day.</span></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a><span class="co">    None</span></span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a>    plt.plot(<span class="bu">range</span>(<span class="bu">len</span>(S)), S, label<span class="op">=</span><span class="st">"S"</span>)</span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a>    plt.plot(<span class="bu">range</span>(<span class="bu">len</span>(I)), I, label<span class="op">=</span><span class="st">"I"</span>)</span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a>    plt.plot(<span class="bu">range</span>(<span class="bu">len</span>(R)), R, label<span class="op">=</span><span class="st">"R"</span>)</span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a>    plt.xlabel(<span class="st">"Time /days"</span>)</span>
<span id="cb19-26"><a href="#cb19-26" tabindex="-1"></a>    plt.ylabel(<span class="st">"Population"</span>)</span>
<span id="cb19-27"><a href="#cb19-27" tabindex="-1"></a>    plt.legend()</span>
<span id="cb19-28"><a href="#cb19-28" tabindex="-1"></a>    plt.show()</span>
<span id="cb19-29"><a href="#cb19-29" tabindex="-1"></a></span>
<span id="cb19-30"><a href="#cb19-30" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb19-31"><a href="#cb19-31" tabindex="-1"></a>    S, I, R <span class="op">=</span> SIR_model(</span>
<span id="cb19-32"><a href="#cb19-32" tabindex="-1"></a>        pop_size<span class="op">=</span><span class="dv">8000000</span>, beta<span class="op">=</span><span class="fl">0.5</span>, gamma<span class="op">=</span><span class="fl">0.1</span>, days<span class="op">=</span><span class="dv">150</span>, I_0<span class="op">=</span><span class="dv">10</span></span>
<span id="cb19-33"><a href="#cb19-33" tabindex="-1"></a>    )</span>
<span id="cb19-34"><a href="#cb19-34" tabindex="-1"></a>    plot_SIR_model(S, I, R)</span>
<span id="cb19-35"><a href="#cb19-35" tabindex="-1"></a></span>
<span id="cb19-36"><a href="#cb19-36" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb19-37"><a href="#cb19-37" tabindex="-1"></a>    main()</span></code></pre>
</div>
<p>If we jump into the directory <code>epi_models/plotting</code>, and
call the following, we get an error:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">$</span> python3 plot_SIR.py</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Traceback (most recent call last):
  File "plot_SIR.py", line 2, in &lt;module&gt;
    from ..models.SIR import SIR_model
ImportError: attempted relative import with no known parent package</code></pre>
</div>
<p>When running a single file as if its a script, Python will not
consider it to be part of a wider package, and hence relative imports
will fail. To solve this, we should run our script from outside the
package using the <code>-m</code> flag:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="ex">$</span> python3 <span class="at">-m</span> epi_models.plotting.plot_SIR</span></code></pre>
</div>
<p>Note that we use dots rather than slashes to separate the names of
each sub-package/module, and we don’t include <code>.py</code> at the
end.</p>
<p>We can also add script-like behaviour to packages by adding a
<code>__main__.py</code> file:</p>
<p><code> 📁 epi_models<br> |<br> |____📦 epi_models<br>      |<br>
     |____📜 __init__.py<br>      |____📜 __main__.py<br>      |<br>
     |____📁 models<br>      |    |<br>      |    |____📜
__init__.py<br>      |    |____📜 SIR.py<br>      |    |____📜
SEIR.py<br>      |    |____📜 SIS.py<br>      |    |____📜 utils.py<br>
     |<br>      |____📁 plotting<br>           |<br>           |____📜
__init__.py<br>           |____📜 plot_SIR.py<br>           |____📜
plot_SEIR.py<br>           |____📜 plot_SIS.py<br></code></p>
<p>As the module name of this file is already <code>__main__</code>,
there’s no need to use the <code>if __name__ == "__main__"</code> idiom,
and we may write this file as if it were a simple script. If we wish to
run the scripting interface from <code>plot_SIR.py</code>, we can do so
simply by importing and calling the function <code>main()</code>:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="co"># file: __main__.py</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a><span class="im">from</span> plotting.plot_SIR <span class="im">import</span> main</span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>main()</span></code></pre>
</div>
<p>If we add a different scripting interface for each model type, we can
use <code>sys.argv</code> to read the user’s model choice from the
command line:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="co"># file: __main__.py</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a><span class="im">from</span> plotting.plot_SIR <span class="im">import</span> main <span class="im">as</span> SIR_main</span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a><span class="im">from</span> plotting.plot_SEIR <span class="im">import</span> main <span class="im">as</span> SEIR_main</span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a><span class="im">from</span> plotting.plot_SIS <span class="im">import</span> main <span class="im">as</span> SIS_main</span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a><span class="co"># Read model type from the command line</span></span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a>model <span class="op">=</span> sys.argv[<span class="dv">1</span>]</span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a><span class="co"># Run the chosen model</span></span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a><span class="cf">if</span> model <span class="op">==</span> <span class="st">"SIR"</span>:</span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a>    SIR_main()</span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a><span class="cf">elif</span> model <span class="op">==</span> <span class="st">"SEIR"</span>:</span>
<span id="cb24-15"><a href="#cb24-15" tabindex="-1"></a>    SEIR_main()</span>
<span id="cb24-16"><a href="#cb24-16" tabindex="-1"></a><span class="cf">elif</span> model <span class="op">==</span> <span class="st">"SIS"</span>:</span>
<span id="cb24-17"><a href="#cb24-17" tabindex="-1"></a>    SIS_main()</span>
<span id="cb24-18"><a href="#cb24-18" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb24-19"><a href="#cb24-19" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">RuntimeError</span>(</span>
<span id="cb24-20"><a href="#cb24-20" tabindex="-1"></a>        <span class="st">"First cmd line arg should be 'SIR', 'SEIR', or 'SIS'"</span></span>
<span id="cb24-21"><a href="#cb24-21" tabindex="-1"></a>    )</span></code></pre>
</div>
<p>If you do intend to add scripting behaviour to your packages, it is
highly recommended to read the ‘extra’ sections in this lesson and the
previous one, as <code>argparse</code> allows you to build much more
sophisticated command line interfaces.</p>
</section><section><h2 class="section-heading" id="extra-advanced-argparse-in-__main__-py">Extra: Advanced <code>argparse</code> in
<code>__main__.py</code>
<a class="anchor" aria-label="anchor" href="#extra-advanced-argparse-in-__main__-py"></a>
</h2>
<hr class="half-width">
<p>TODO: Remove advanced argparse section</p>
<p>Let’s return to <code>plot_SIR.py</code>, and apply the enhancements
discussed in the ‘extra’ sections last lesson:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="im">from</span> argparse <span class="im">import</span> ArgumentParser</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="im">from</span> ..models.SIR <span class="im">import</span> SIR_model</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a><span class="kw">def</span> plot_SIR_model(S, I, R, ax<span class="op">=</span><span class="va">None</span>, save_to<span class="op">=</span><span class="va">None</span>, show<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a><span class="co">    Plot the results of a SIR simulation.</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a><span class="co">    S: List[float]</span></span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a><span class="co">        Number of susceptible people on each day.</span></span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a><span class="co">    I: List[float]</span></span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a><span class="co">        Number of infected people on each day.</span></span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a><span class="co">    R: List[float]</span></span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a><span class="co">        Number of recovered people on each day.</span></span>
<span id="cb25-17"><a href="#cb25-17" tabindex="-1"></a><span class="co">    ax: Optional[plt.Axes], default None</span></span>
<span id="cb25-18"><a href="#cb25-18" tabindex="-1"></a><span class="co">        Axes object on which to create the plot.</span></span>
<span id="cb25-19"><a href="#cb25-19" tabindex="-1"></a><span class="co">        A new Axes is created if this is None.</span></span>
<span id="cb25-20"><a href="#cb25-20" tabindex="-1"></a><span class="co">    save_to: Optional[str], default None</span></span>
<span id="cb25-21"><a href="#cb25-21" tabindex="-1"></a><span class="co">        Name of the file to save the plot to.</span></span>
<span id="cb25-22"><a href="#cb25-22" tabindex="-1"></a><span class="co">        Does not save if None.</span></span>
<span id="cb25-23"><a href="#cb25-23" tabindex="-1"></a><span class="co">    show: bool, default False</span></span>
<span id="cb25-24"><a href="#cb25-24" tabindex="-1"></a><span class="co">        If True, call plt.show() on completion.</span></span>
<span id="cb25-25"><a href="#cb25-25" tabindex="-1"></a></span>
<span id="cb25-26"><a href="#cb25-26" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb25-27"><a href="#cb25-27" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb25-28"><a href="#cb25-28" tabindex="-1"></a><span class="co">    plt.Axes</span></span>
<span id="cb25-29"><a href="#cb25-29" tabindex="-1"></a><span class="co">        The axes object the results have been plotted to.</span></span>
<span id="cb25-30"><a href="#cb25-30" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb25-31"><a href="#cb25-31" tabindex="-1"></a>    <span class="co"># Use plt.subplots to create Figure and Axes objects</span></span>
<span id="cb25-32"><a href="#cb25-32" tabindex="-1"></a>    <span class="co"># if one is not provided.</span></span>
<span id="cb25-33"><a href="#cb25-33" tabindex="-1"></a>    <span class="cf">if</span> ax <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb25-34"><a href="#cb25-34" tabindex="-1"></a>        fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb25-35"><a href="#cb25-35" tabindex="-1"></a></span>
<span id="cb25-36"><a href="#cb25-36" tabindex="-1"></a>    <span class="co"># Create plot</span></span>
<span id="cb25-37"><a href="#cb25-37" tabindex="-1"></a>    ax.plot(<span class="bu">range</span>(<span class="bu">len</span>(S)), S, label<span class="op">=</span><span class="st">"S"</span>)</span>
<span id="cb25-38"><a href="#cb25-38" tabindex="-1"></a>    ax.plot(<span class="bu">range</span>(<span class="bu">len</span>(I)), I, label<span class="op">=</span><span class="st">"I"</span>)</span>
<span id="cb25-39"><a href="#cb25-39" tabindex="-1"></a>    ax.plot(<span class="bu">range</span>(<span class="bu">len</span>(R)), R, label<span class="op">=</span><span class="st">"R"</span>)</span>
<span id="cb25-40"><a href="#cb25-40" tabindex="-1"></a>    ax.set_xlabel(<span class="st">"Time /days"</span>)</span>
<span id="cb25-41"><a href="#cb25-41" tabindex="-1"></a>    ax.set_ylabel(<span class="st">"Population"</span>)</span>
<span id="cb25-42"><a href="#cb25-42" tabindex="-1"></a>    ax.legend()</span>
<span id="cb25-43"><a href="#cb25-43" tabindex="-1"></a></span>
<span id="cb25-44"><a href="#cb25-44" tabindex="-1"></a>    <span class="co"># Optionally save the figure</span></span>
<span id="cb25-45"><a href="#cb25-45" tabindex="-1"></a>    <span class="cf">if</span> save_to <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb25-46"><a href="#cb25-46" tabindex="-1"></a>        fig <span class="op">=</span> ax.get_figure()</span>
<span id="cb25-47"><a href="#cb25-47" tabindex="-1"></a>        fig.savefig(save_to)</span>
<span id="cb25-48"><a href="#cb25-48" tabindex="-1"></a></span>
<span id="cb25-49"><a href="#cb25-49" tabindex="-1"></a>    <span class="co"># Optionally show the figure</span></span>
<span id="cb25-50"><a href="#cb25-50" tabindex="-1"></a>    <span class="cf">if</span> show:</span>
<span id="cb25-51"><a href="#cb25-51" tabindex="-1"></a>        plt.show()</span>
<span id="cb25-52"><a href="#cb25-52" tabindex="-1"></a></span>
<span id="cb25-53"><a href="#cb25-53" tabindex="-1"></a>    <span class="cf">return</span> ax</span>
<span id="cb25-54"><a href="#cb25-54" tabindex="-1"></a></span>
<span id="cb25-55"><a href="#cb25-55" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb25-56"><a href="#cb25-56" tabindex="-1"></a>    <span class="co"># Create an argument parser object. We can provide</span></span>
<span id="cb25-57"><a href="#cb25-57" tabindex="-1"></a>    <span class="co"># some info about our program here.</span></span>
<span id="cb25-58"><a href="#cb25-58" tabindex="-1"></a>    parser <span class="op">=</span> ArgumentParser(</span>
<span id="cb25-59"><a href="#cb25-59" tabindex="-1"></a>        prog<span class="op">=</span><span class="st">"SIR_model"</span>,</span>
<span id="cb25-60"><a href="#cb25-60" tabindex="-1"></a>        description<span class="op">=</span><span class="st">"Solves SIR model and creates a plot"</span>,</span>
<span id="cb25-61"><a href="#cb25-61" tabindex="-1"></a>    )</span>
<span id="cb25-62"><a href="#cb25-62" tabindex="-1"></a></span>
<span id="cb25-63"><a href="#cb25-63" tabindex="-1"></a>    <span class="co"># Add each argument to the parser. We can specify</span></span>
<span id="cb25-64"><a href="#cb25-64" tabindex="-1"></a>    <span class="co"># the types of each argument. Optional arguments</span></span>
<span id="cb25-65"><a href="#cb25-65" tabindex="-1"></a>    <span class="co"># should have single character names with a hypen,</span></span>
<span id="cb25-66"><a href="#cb25-66" tabindex="-1"></a>    <span class="co"># or longer names with a double dash.</span></span>
<span id="cb25-67"><a href="#cb25-67" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb25-68"><a href="#cb25-68" tabindex="-1"></a>        <span class="st">"--version"</span>,</span>
<span id="cb25-69"><a href="#cb25-69" tabindex="-1"></a>        action<span class="op">=</span><span class="st">"version"</span>,</span>
<span id="cb25-70"><a href="#cb25-70" tabindex="-1"></a>        version<span class="op">=</span><span class="st">"</span><span class="sc">%(prog)s</span><span class="st"> </span><span class="sc">{version}</span><span class="st">"</span>.<span class="bu">format</span>(version<span class="op">=</span>__version__),</span>
<span id="cb25-71"><a href="#cb25-71" tabindex="-1"></a>        <span class="bu">help</span><span class="op">=</span><span class="st">"Show program's version number and exit."</span>,</span>
<span id="cb25-72"><a href="#cb25-72" tabindex="-1"></a>    )</span>
<span id="cb25-73"><a href="#cb25-73" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb25-74"><a href="#cb25-74" tabindex="-1"></a>        <span class="st">"-p"</span>, <span class="st">"--pop_size"</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">int</span>, default<span class="op">=</span><span class="dv">10000000</span>,</span>
<span id="cb25-75"><a href="#cb25-75" tabindex="-1"></a>        <span class="bu">help</span><span class="op">=</span><span class="st">"Total population size"</span>,</span>
<span id="cb25-76"><a href="#cb25-76" tabindex="-1"></a>    )</span>
<span id="cb25-77"><a href="#cb25-77" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb25-78"><a href="#cb25-78" tabindex="-1"></a>        <span class="st">"-b"</span>, <span class="st">"--beta"</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">float</span>, default<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb25-79"><a href="#cb25-79" tabindex="-1"></a>        <span class="bu">help</span><span class="op">=</span><span class="st">"Average no. of new infections per infected person per day"</span>,</span>
<span id="cb25-80"><a href="#cb25-80" tabindex="-1"></a>    )</span>
<span id="cb25-81"><a href="#cb25-81" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb25-82"><a href="#cb25-82" tabindex="-1"></a>        <span class="st">"-g"</span>, <span class="st">"--gamma"</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">float</span>, default<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb25-83"><a href="#cb25-83" tabindex="-1"></a>        <span class="bu">help</span><span class="op">=</span><span class="st">"Inverse of average number of days taken to recover"</span>,</span>
<span id="cb25-84"><a href="#cb25-84" tabindex="-1"></a>    )</span>
<span id="cb25-85"><a href="#cb25-85" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb25-86"><a href="#cb25-86" tabindex="-1"></a>        <span class="st">"-d"</span>, <span class="st">"--days"</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">int</span>, default<span class="op">=</span><span class="dv">150</span>,</span>
<span id="cb25-87"><a href="#cb25-87" tabindex="-1"></a>        <span class="bu">help</span><span class="op">=</span><span class="st">"Number of days to run the simulation"</span>,</span>
<span id="cb25-88"><a href="#cb25-88" tabindex="-1"></a>    )</span>
<span id="cb25-89"><a href="#cb25-89" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb25-90"><a href="#cb25-90" tabindex="-1"></a>        <span class="st">"-i"</span>, <span class="st">"--i0"</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">int</span>, default<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb25-91"><a href="#cb25-91" tabindex="-1"></a>        <span class="bu">help</span><span class="op">=</span><span class="st">"Number of infected people at the start of the simulation"</span>,</span>
<span id="cb25-92"><a href="#cb25-92" tabindex="-1"></a>    )</span>
<span id="cb25-93"><a href="#cb25-93" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb25-94"><a href="#cb25-94" tabindex="-1"></a>        <span class="st">"-o"</span>, <span class="st">"--output"</span>, default<span class="op">=</span><span class="st">"SIR_model.png"</span>,</span>
<span id="cb25-95"><a href="#cb25-95" tabindex="-1"></a>        <span class="bu">help</span><span class="op">=</span><span class="st">"Output file to save plot to"</span>,</span>
<span id="cb25-96"><a href="#cb25-96" tabindex="-1"></a>    )</span>
<span id="cb25-97"><a href="#cb25-97" tabindex="-1"></a></span>
<span id="cb25-98"><a href="#cb25-98" tabindex="-1"></a>    <span class="co"># Get each argument from the command line</span></span>
<span id="cb25-99"><a href="#cb25-99" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb25-100"><a href="#cb25-100" tabindex="-1"></a></span>
<span id="cb25-101"><a href="#cb25-101" tabindex="-1"></a>    <span class="co"># Run our code</span></span>
<span id="cb25-102"><a href="#cb25-102" tabindex="-1"></a>    S, I, R <span class="op">=</span> SIR_model(</span>
<span id="cb25-103"><a href="#cb25-103" tabindex="-1"></a>        pop_size<span class="op">=</span>args.pop_size,</span>
<span id="cb25-104"><a href="#cb25-104" tabindex="-1"></a>        beta<span class="op">=</span>args.beta,</span>
<span id="cb25-105"><a href="#cb25-105" tabindex="-1"></a>        gamma<span class="op">=</span>args.gamma,</span>
<span id="cb25-106"><a href="#cb25-106" tabindex="-1"></a>        days<span class="op">=</span>args.days,</span>
<span id="cb25-107"><a href="#cb25-107" tabindex="-1"></a>        I_0<span class="op">=</span>args.i0,</span>
<span id="cb25-108"><a href="#cb25-108" tabindex="-1"></a>    )</span>
<span id="cb25-109"><a href="#cb25-109" tabindex="-1"></a>    plot_SIR_model(S, I, R, save_to<span class="op">=</span>args.output)</span>
<span id="cb25-110"><a href="#cb25-110" tabindex="-1"></a></span>
<span id="cb25-111"><a href="#cb25-111" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb25-112"><a href="#cb25-112" tabindex="-1"></a>    main()</span></code></pre>
</div>
<p>Finally, we will need to add <code>__version__</code> variable to
<strong>init</strong>.py</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="co"># File: __init__.py</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>__version__ <span class="op">=</span> <span class="fl">0.0.1</span></span></code></pre>
</div>
<p>We can now check the version using the <code>--version</code>
argument.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="ex">$</span> python3 <span class="at">-m</span> epi_models.plotting.plot_SIR <span class="at">--version</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Packages can be used to better organise our code as it becomes more
complex</li>
<li>Packages are defined by a directory structure and the presence of
<code>__init__.py</code>
</li>
<li>By controlling what is or isn’t imported in
<code>__init__.py</code>, we can define a public API for our
project.</li>
<li>A package can be run as a script using the <code>-m</code> flag,
provided it contains a file <code>__main__.py</code>.</li>
<li>Through clever use of <code>argparse</code>, we can provide a rich
scripting interface to a whole package.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-03-building-and-installing"><p>Content from <a href="03-building-and-installing.html">Building and Installing Packages using hatch</a></p>
<hr>
<p>Last updated on 2024-12-10 |

        <a href="https://github.com/carpentries-incubator/python_packaging/edit/main/episodes/03-building-and-installing.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can we manage our Python environment?</li>
<li>How can we install our own packages?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Use <code>conda</code> to manage Python environments</li>
<li>Understand what happens when we install a package</li>
<li>Use <code>pip</code> and <code>hatch</code> to install packages to
our local environment</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>In the first lesson, we showed how to use the <code>PYTHONPATH</code>
environment variable to enable us to import our modules and packages
from anywhere on our system. There are a few disadvantages to this
method:</p>
<ul>
<li>If we have two different versions of a package on our system at
once, it can be tedious to manually update <code>PYTHONPATH</code>
whenever we want to switch between them.</li>
<li>If we have multiple Python environments on our system (using tools
such as <code>venv</code> or <code>conda</code>), setting
<code>PYTHONPATH</code> will affect all of them. This can lead to
unexpected dependency conflicts that can be very hard to debug.</li>
<li>If we share our software with others and require them to update
their own <code>PYTHONPATH</code>, they will need to install any
requirements for our package separately, which can be error prone.</li>
</ul>
<p>It would be preferable if we could install our package using
<code>pip</code>, the same way that we would normally install external
Python packages. However, if we enter the top level directory of our
project and try the following:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">$</span> cd /path/to/my/workspace/epi_models</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">$</span> python <span class="at">-m</span> pip install .</span></code></pre>
</div>
<p>We get the following error:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>ERROR: Directory '.' is not installable. Neither 'setup.py' nor 'pyproject.toml' found.</code></pre>
</div>
<p>In order to make our project installable, we need to add the either
the file <code>pyproject.toml</code> or <code>setup.py</code> to our
project. For modern Python projects, it is recommended to write only
<code>pyproject.toml</code>. This was introduced by <a href="https://peps.python.org/pep-0517/" class="external-link">PEP 517</a>, <a href="https://peps.python.org/pep-0518/" class="external-link">PEP 518</a> and <a href="https://peps.python.org/pep-0621/" class="external-link">PEP 621</a> as a standard way
to define a Python project, and all tools that build, install, and
publish Python packages are expected to use it.</p>
<p>By making our project <code>pip</code>-installable, we’ll also make
it very easy to publish our packages on public repositories – this will
be covered in our <a href="./04-publishing.html">lesson on package
publishing</a>. After publishing our work, our users will be able to
download and install our package using <code>pip</code> from any machine
of their chocie!</p>
<p>To begin, we’ll introduce the concept of a ‘Python environment’, and
how these can help us manage our workflows.</p>
</section><section><h2 class="section-heading" id="managing-python-environments">Managing Python Environments<a class="anchor" aria-label="anchor" href="#managing-python-environments"></a>
</h2>
<hr class="half-width">
<p>When working with Python, it can sometimes be beneficial to install
packages to an isolated environment instead of installing them globally.
Usually, this is done to manage competing dependencies:</p>
<ul>
<li>Project B might depend upon Project A, but may have been written to
use version 1.0.</li>
<li>Project C might also depend upon Project A, but may instead only
work with version 2.0.</li>
<li>If we install Project A globally and choose version 2.0, then
Project B will not work. Similarly, if we choose version 1.0, Project C
will not work.</li>
</ul>
<p>A good way to handle these sorts of conflicts is to instead use
<em>virtual environments</em> for each project. A number of tools have
been developed to manage virtual environments, such as
<code>venv</code>, which is a standard built-in Python tool, and
<code>conda</code>, which is a powerful third-party tool.</p>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>You can <code>pip install</code> packages into a <code>conda</code>
virtual environment.</p>
</div>
</div>
</div>
<p>If we’re using Linux, we can find which Python environment we’re
using by calling:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">$</span> which python</span></code></pre>
</div>
<p>If we’re using the default system environment, the result is
something like the following:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>/usr/bin/python</code></pre>
</div>
<p>To create a new <code>conda</code> environment called “packaging”
with Python v3.12 installed, we can call:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># Create a new environment</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="ex">$</span> conda create <span class="at">-n</span> packaging python=3.12 matplotlib hatch <span class="at">-c</span> conda-forge</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co"># It is a good idea to clean up cached and unused files </span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="ex">$</span> conda clean <span class="at">--all</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co"># You can always check available envs with</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="ex">$</span> conda env list</span></code></pre>
</div>
<p>Now we can activate our new conda environment:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Start the env</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="ex">$</span> conda activate packaging </span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co"># To check which packages are installed in the env run:</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="ex">$</span> conda list</span></code></pre>
</div>
<p>Checking which Python we’re running should now give a different
result:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">$</span> which python</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>/Users/username/miniforge3/envs/packaging/bin/python</code></pre>
</div>
<p>If we now install a new package, it will be installed within our new
virtual environment instead of being installed to the system libraries.
For example:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">$</span> pip install numpy</span></code></pre>
</div>
<p>We can check the location of <code>numpy</code> using
<code>pip show</code>:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">pip</span> show numpy</span></code></pre>
</div>
<p><code>site-packages</code> is a standard location to store installed
Python packages.</p>
<p>If we no longer wish to use this virtual environment, we can return
to the base environment by calling:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">$</span> conda deactivate</span></code></pre>
</div>
<p>Virtual environments are very useful when we’re testing our code, as
they allow us to create a fresh Python environment without any of the
installed packages we normally use in our work. This will be important
later when we add dependencies to our package, as this allows us to test
whether our users will be able to install and run our code properly
using a fresh environment.</p>
</section><section><h2 class="section-heading" id="an-overview-of-toml-files">An Overview of TOML files<a class="anchor" aria-label="anchor" href="#an-overview-of-toml-files"></a>
</h2>
<hr class="half-width">
<p><code>pyproject.toml</code> is a TOML file, which stands for ‘Tom’s
Obvious Minimal Langauge’ (named for its developer, Thomas
Preston-Werner, who cofounded GitHub). There are many configuration file
formats in common usage, such as YAML, JSON, and INI, but the Python
community chose TOML as it provides some benefits over the
competition:</p>
<ul>
<li>Designed to be human writable and human readable.</li>
<li>Can map unambiguously to a hash table (a <code>dict</code> in
Python).</li>
<li>It has a formal specification, so has an unambiguous set of
rules.</li>
</ul>
<p>A TOML file contains a series of <code>key = value</code> pairs,
which may be grouped into sections using a header enclosed in square
brackets, such as <code>[section name]</code>. The values are typed,
unlike some other formats where all values are strings. The available
types are strings, integers, floats, booleans, and dates. It is possible
to store lists of values in arrays, or store a series of key-value pairs
in tables. For example:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># file: mytoml.toml</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="dt">int_val</span> <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="dt">float_val</span> <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="dt">string_val</span> <span class="op">=</span> <span class="st">"hello world"</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="dt">bool_val</span> <span class="op">=</span> <span class="cn">true</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="dt">date_val</span> <span class="op">=</span> <span class="bn">2023-01-01T08:00:00</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="dt">array</span> <span class="op">=</span> <span class="op">[</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">]</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="dt">inline_table</span> <span class="op">=</span> <span class="op">{</span><span class="dt">key</span><span class="op"> =</span> <span class="st">"value"</span><span class="op">}</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co"># Section headings allow us to define tables over</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co"># multiple lines</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="kw">[header_table]</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">"John"</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="dt">dob</span> <span class="op">=</span> <span class="bn">2002-03-05</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="co"># We can define subtables using dot notation</span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="kw">[header_table.subtable]</span></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a><span class="dt">foo</span> <span class="op">=</span> <span class="st">"bar"</span></span></code></pre>
</div>
<p>We can read this using the <code>tomllib</code> library in
Python:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> tomllib</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="cf">with</span> <span class="bu">open</span>(<span class="st">"mytoml.toml"</span>, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>...     data <span class="op">=</span> toml.load(f)</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">print</span>(data)</span></code></pre>
</div>
<p>The result is a dictionary object, with TOML types converted to their
corresponding Python types:</p>
<pre class="result"><code>{
    'int_val': 5,
    'float_val': 0.5,
    'string_val': 'hello world',
    'bool_val': True,
    'date_val': datetime.datetime(2023, 1, 1, 8, 0),
    'array': [1, 2, 3],
    'inline_table': {'key': 'value'},
    'header_table': {
        'name': 'John',
        'dob': datetime.date(2002, 3, 5),
        'subtable': {
            'foo': 'bar'
        }
    }
}</code></pre>
</section><section><h2 class="section-heading" id="installing-our-package-with-pyproject-toml">Installing our package with <code>pyproject.toml</code>
<a class="anchor" aria-label="anchor" href="#installing-our-package-with-pyproject-toml"></a>
</h2>
<hr class="half-width">
<p>First, we will show how to write a relatively minimal
<code>pyproject.toml</code> file so that we can install our projects
using <code>pip</code>. We will then cover some additional tricks that
can be achieved with this file:</p>
<ul>
<li>Use alternative directory structures</li>
<li>Include any data files needed by our code</li>
<li>Generate an executable so that our scripts can be run directly from
the command line</li>
<li>Configure our development tools.</li>
</ul>
<p>To make our package <code>pip</code>-installable, we should add the
file <code>pyproject.toml</code> to the top-level
<code>learn-hatch</code> directory:</p>
<p><code> 📁 learn-hatch<br> |<br> |____📜 pyproject.toml<br> |<br>
|____📁 src<br>      |<br>      |____📦 epi_models<br>           |<br>
          |____📜 __init__.py<br>           |____📜 __main__.py<br>
          |<br>           |____📁 models<br>           |    |<br>
          |    |____📜 __init__.py<br>           |    |____📜 SIR.py<br>
          |    |____📜 SEIR.py<br>           |    |____📜 SIS.py<br>
          |    |____📜 utils.py<br>           |<br>           |____📁
plotting<br>                |<br>                |____📜 __init__.py<br>
               |____📜 plot_SIR.py<br>                |____📜
plot_SEIR.py<br>                |____📜 plot_SIS.py<br></code></p>
<p>The first section in our <code>pyproject.toml</code> file should
specify which build system we wish to use, and additionally specify any
version requirements for packages used to build our code.</p>
<p>We will choose to use <code>hatchling</code>, which requires the
following:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># file: pyproject.toml</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="kw">[build-system]</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="dt">requires</span> <span class="op">=</span> <span class="op">[</span><span class="st">"hatchling"</span><span class="op">]</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="dt">build-backend</span> <span class="op">=</span> <span class="st">"hatchling.build"</span></span></code></pre>
</div>
<ul>
<li>
<code>requires</code> is set to a list of strings, each of which
names a dependency of the build system and (optionally) its minimum
version. This uses the same version syntax as <code>pip</code>.</li>
<li>
<code>build-backend</code> is set to a sub-module of
<code>hatchling</code> which implements the <a href="https://peps.python.org/pep-0517/" class="external-link">PEP 517</a> build
interface.</li>
</ul>
<p>With our build system determined, we can add some metadata that
defines our project. At a minimum, we should specify the name of the
package, its version, and our dependencies:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co"># file: pyproject.toml</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="co"># Build system configuration</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="kw">[build-system]</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="dt">requires</span> <span class="op">=</span> <span class="op">[</span><span class="st">"hatchling"</span><span class="op">]</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="dt">build-backend</span> <span class="op">=</span> <span class="st">"hatchling.build"</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co"># Project metadata</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="kw">[project]</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">"epi_models"</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="dt">version</span> <span class="op">=</span> <span class="st">"0.1.0"</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="dt">dependencies</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>    <span class="st">"matplotlib"</span><span class="op">,</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a><span class="op">]</span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a><span class="co"># Hatch build configuration</span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a><span class="kw">[tool.hatch.build]</span></span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a><span class="dt">source</span> <span class="op">=</span> <span class="st">"src"</span></span></code></pre>
</div>
<p>That’s all we need! We’ll discuss versioning in our <a href="04-publishing.html">lesson on publishing</a>. With this done, we
can install our package using:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">$</span> pip install .</span></code></pre>
</div>
<p>This will automatically download and install our dependencies, and
our package will be importable regardless of which directory we’re
in.</p>
<p>The installed package can be found in the directory
<code>/Users/username/miniforge3/envs/packaging/lib/python3.12/site-packages/epi_models</code>.</p>
<p>If we look inside our installed package, we’ll see that our files
have been copied, and there is also a <code>__pycache__</code>
directory:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="ex">$</span> ls /path/to/my/env/lib/python3.12/site-packages/epi_models</span></code></pre>
</div>
<pre class="results"><code>__init__.py  __main__.py  models  plotting  __pycache__</code></pre>
<p>The <code>__pycache__</code> directory contains Python bytecode,
which is a lower-level version of Python that is understood by the
Python Virtual Machine (PVM). All of our Python code is converted to
bytecode when it is run or imported, and by pre-compiling our package it
can be imported much faster. If we look into the directories
<code>models</code> and <code>plotting</code>, we’ll see those have been
compiled to bytecode too.</p>
<p>If we wish to uninstall, we may call:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">$</span> pip uninstall epi_models</span></code></pre>
</div>
<p>We can also create an ‘editable install’, in which any changes we
make to our code are instantly recognised by any codes importing it –
this mode can be very useful when developing our code, especially when
working on documentation or tests.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="ex">$</span> pip install <span class="at">-e</span> .</span></code></pre>
</div>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>The ability to create editable installs from a
<code>pyproject.toml</code>-only build was standardised in <a href="https://peps.python.org/pep-0660/" class="external-link">PEP 660</a>, and only recently
implemented in <code>pip</code>. You may need to upgrade to use this
feature:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="ex">$</span> python <span class="at">-m</span> pip install <span class="at">--upgrade</span> pip</span></code></pre>
</div>
</div>
</div>
</div>
<p>There are many other options we can add to our
<code>pyproject.toml</code> to better describe our project. <a href="https://peps.python.org/pep-0621/" class="external-link">PEP 621</a> defines a minimum
list of possible metadata that all build tools should support, so we’ll
stick to that list. Each build tool will also define synonyms for some
metadata entries, and additional tool-specific metadata. Some of the
recommended core metadata keys are described below:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="co"># file: pyproject.toml</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a><span class="co"># Build system configuration</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a><span class="kw">[build-system]</span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a><span class="dt">requires</span> <span class="op">=</span> <span class="op">[</span><span class="st">"hatchling"</span><span class="op">]</span></span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a><span class="dt">build-backend</span> <span class="op">=</span> <span class="st">"hatchling.build"</span></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a><span class="co"># Project metadata</span></span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a><span class="kw">[project]</span></span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">"epi_models"</span></span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a><span class="dt">version</span> <span class="op">=</span> <span class="st">"0.1.0"</span></span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a><span class="dt">dependencies</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a>    <span class="st">"matplotlib"</span><span class="op">,</span></span>
<span id="cb23-15"><a href="#cb23-15" tabindex="-1"></a><span class="op">]</span></span>
<span id="cb23-16"><a href="#cb23-16" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" tabindex="-1"></a><span class="co"># A simple summary of the project</span></span>
<span id="cb23-18"><a href="#cb23-18" tabindex="-1"></a><span class="dt">description</span> <span class="op">=</span> <span class="st">"My wonderful Python package"</span></span>
<span id="cb23-19"><a href="#cb23-19" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" tabindex="-1"></a><span class="co"># Full description of the project.</span></span>
<span id="cb23-22"><a href="#cb23-22" tabindex="-1"></a><span class="co"># Should be the path to your README file, relative to pyproject.toml</span></span>
<span id="cb23-23"><a href="#cb23-23" tabindex="-1"></a><span class="dt">readme</span> <span class="op">=</span> <span class="st">"README.md"</span></span>
<span id="cb23-24"><a href="#cb23-24" tabindex="-1"></a></span>
<span id="cb23-25"><a href="#cb23-25" tabindex="-1"></a><span class="co"># The Python version required by the project</span></span>
<span id="cb23-26"><a href="#cb23-26" tabindex="-1"></a><span class="dt">requires-python</span> <span class="op">=</span> <span class="st">"&gt;=3.8"</span></span>
<span id="cb23-27"><a href="#cb23-27" tabindex="-1"></a></span>
<span id="cb23-28"><a href="#cb23-28" tabindex="-1"></a><span class="co"># The license of your project.</span></span>
<span id="cb23-29"><a href="#cb23-29" tabindex="-1"></a><span class="co"># Can be provided as a file or a text description.</span></span>
<span id="cb23-30"><a href="#cb23-30" tabindex="-1"></a><span class="co"># Discussed in the lesson on publishing</span></span>
<span id="cb23-31"><a href="#cb23-31" tabindex="-1"></a><span class="dt">license</span> <span class="op">=</span> <span class="op">{</span><span class="dt">file</span><span class="op"> =</span> <span class="st">"LICENSE.md"</span><span class="op">}</span></span>
<span id="cb23-32"><a href="#cb23-32" tabindex="-1"></a><span class="co"># or...</span></span>
<span id="cb23-33"><a href="#cb23-33" tabindex="-1"></a><span class="dt">license</span> <span class="op">=</span> <span class="op">{</span><span class="dt">text</span><span class="op"> =</span> <span class="st">"BDS 3-Clause License"</span><span class="op">}</span></span>
<span id="cb23-34"><a href="#cb23-34" tabindex="-1"></a></span>
<span id="cb23-35"><a href="#cb23-35" tabindex="-1"></a></span>
<span id="cb23-36"><a href="#cb23-36" tabindex="-1"></a></span>
<span id="cb23-37"><a href="#cb23-37" tabindex="-1"></a><span class="co"># Authors / maintainers</span></span>
<span id="cb23-38"><a href="#cb23-38" tabindex="-1"></a><span class="co"># Each entry can have a name and/or an email</span></span>
<span id="cb23-39"><a href="#cb23-39" tabindex="-1"></a><span class="dt">authors</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb23-40"><a href="#cb23-40" tabindex="-1"></a>    <span class="op">{</span><span class="dt">name</span><span class="op"> =</span> <span class="st">"My Name"</span><span class="op">, </span><span class="dt">email</span><span class="op"> =</span> <span class="st">"my.email@email.net"</span><span class="op">},</span></span>
<span id="cb23-41"><a href="#cb23-41" tabindex="-1"></a>    <span class="op">{</span><span class="dt">name</span><span class="op"> =</span> <span class="st">"My Friend"</span><span class="op">, </span><span class="dt">email</span><span class="op"> =</span> <span class="st">"their.email@email.net"</span><span class="op">},</span></span>
<span id="cb23-42"><a href="#cb23-42" tabindex="-1"></a><span class="op">]</span></span>
<span id="cb23-43"><a href="#cb23-43" tabindex="-1"></a></span>
<span id="cb23-44"><a href="#cb23-44" tabindex="-1"></a><span class="co"># dependencies: Array of Strings</span></span>
<span id="cb23-45"><a href="#cb23-45" tabindex="-1"></a><span class="co"># A list of requirements for our package</span></span>
<span id="cb23-46"><a href="#cb23-46" tabindex="-1"></a><span class="dt">dependencies</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb23-47"><a href="#cb23-47" tabindex="-1"></a>    <span class="st">"matplotlib"</span><span class="op">,</span></span>
<span id="cb23-48"><a href="#cb23-48" tabindex="-1"></a><span class="op">]</span></span>
<span id="cb23-49"><a href="#cb23-49" tabindex="-1"></a></span>
<span id="cb23-50"><a href="#cb23-50" tabindex="-1"></a><span class="co"># Project URLs</span></span>
<span id="cb23-51"><a href="#cb23-51" tabindex="-1"></a><span class="kw">[project.urls]</span></span>
<span id="cb23-52"><a href="#cb23-52" tabindex="-1"></a><span class="dt">homepage</span> <span class="op">=</span> <span class="st">"https://github.com/username/learn-hatch"</span></span>
<span id="cb23-53"><a href="#cb23-53" tabindex="-1"></a><span class="dt">documentation</span> <span class="op">=</span> <span class="st">"https://github.com/username/learn-hatch"</span></span>
<span id="cb23-54"><a href="#cb23-54" tabindex="-1"></a><span class="dt">repository</span> <span class="op">=</span> <span class="st">"https://github.com/username/learn-hatch"</span></span>
<span id="cb23-55"><a href="#cb23-55" tabindex="-1"></a></span>
<span id="cb23-56"><a href="#cb23-56" tabindex="-1"></a><span class="co"># Hatch build configuration</span></span>
<span id="cb23-57"><a href="#cb23-57" tabindex="-1"></a><span class="kw">[tool.hatch.build]</span></span>
<span id="cb23-58"><a href="#cb23-58" tabindex="-1"></a><span class="dt">source</span> <span class="op">=</span> <span class="st">"src"</span></span>
<span id="cb23-59"><a href="#cb23-59" tabindex="-1"></a></span>
<span id="cb23-60"><a href="#cb23-60" tabindex="-1"></a></span></code></pre>
</div>
<p>TODO: Discuss including package data file with hatch.</p>
</section><section><h2 class="section-heading" id="installing-scripts">Installing Scripts<a class="anchor" aria-label="anchor" href="#installing-scripts"></a>
</h2>
<hr class="half-width">
<p>If our package contains any scripts and/or a <code>__main__.py</code>
file, we can run those from anywhere on our system after
installation:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="ex">$</span> python <span class="at">-m</span> epi_models</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="ex">$</span> python <span class="at">-m</span> epi_models.plotting.plot_SIR</span></code></pre>
</div>
<p>With a little extra work, we can also install a simplified interface
that doesn’t require <code>python -m</code> in front. This is how tools
like <code>pip</code> can be invoked using two possible methods:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="ex">$</span> python <span class="at">-m</span> pip  <span class="co"># Invoke with python</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="ex">$</span> pip             <span class="co"># Invoke via console-scripts entrypoint</span></span></code></pre>
</div>
<p>This can be achieved by adding a table <code>scripts</code> under the
<code>[project]</code> header:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="co"># file: pyproject.toml</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="co"># Add entry points</span></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="kw">[project.scripts]</span></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a><span class="dt">epi_models</span> <span class="op">=</span> <span class="st">"epi_models.__main__:main"</span></span></code></pre>
</div>
<p>This syntax means that we should create a console script
<code>epi_models</code>, and that running it should call the function
<code>main()</code> from the file <code>epi_models/__main__.py</code>.
This will require a slight modification to our <code>__main__.py</code>
file. All that’s necessary is to move everything from the script into a
function <code>main()</code> that takes no arguments, and then to call
<code>main()</code> at the bottom of the script:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="co"># file: main.py</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>    <span class="co"># Put the __main__ script here...</span></span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a>main()</span></code></pre>
</div>
<p>This will allow us to run our package as a script directly from the
command line</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="ex">$</span> python <span class="at">-m</span> pip install .</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a><span class="ex">$</span> epi_models <span class="at">--help</span></span></code></pre>
</div>
<p>Note that we’ll still be able to run our code using the longer
form:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="ex">$</span> python <span class="at">-m</span> src/epi_models <span class="at">--help</span></span></code></pre>
</div>
<p>If we have multiple scripts in our package, these can all be given
invidual console scripts. However, these will also need to have a
function name as an entry point:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="co"># file: pyproject.toml</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a><span class="kw">[project.scripts]</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a><span class="dt">epi_models</span> <span class="op">=</span> <span class="st">"epi_models.__main__:main"</span></span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a><span class="dt">epi_models_sir</span> <span class="op">=</span> <span class="st">"epi_models.plotting.plot_SIR:main"</span></span></code></pre>
</div>
<p>TODO: remove this?</p>
<p>So how do these scripts work? When we activate a virtual environment,
a new entry is added to our <code>PATH</code> environment variable
linking to <code>/path/to/my/env/bin/</code>:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="ex">PATH</span> = <span class="st">"/path/to/my/env/bin:</span><span class="va">${PATH}</span><span class="st">"</span></span></code></pre>
</div>
<p>After installing our console scripts, we can find a new file in this
directory with the name we assigned to it. For example,
<code>/path/to/my/env/bin/epi_models</code>:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="co">#!/path/to/my/env/bin/python</span></span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a><span class="co"># -*- coding: utf-8 -*-</span></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a><span class="im">from</span> epi_models.__main__ <span class="im">import</span> main</span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a>    sys.argv[<span class="dv">0</span>] <span class="op">=</span> re.sub(<span class="vs">r'(-script\.pyw|\.exe)?$'</span>, <span class="st">''</span>, sys.argv[<span class="dv">0</span>])</span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a>    sys.exit(main())</span></code></pre>
</div>
<p>Installing our project has automatically created a new Python file
that can be run as a command line script due to the hash-bang
(<code>#!</code>) on the top line, and all it does it import our main
function and run it. As it’s contained with the <code>bin/</code>
directory of our Python environment, it’s available for use as long
we’re using that environment, but as soon as we call
<code>deactivate</code>, it is removed from our <code>PATH</code>.</p>
</section><section><h2 class="section-heading" id="setting-dependency-versions">Setting Dependency Versions<a class="anchor" aria-label="anchor" href="#setting-dependency-versions"></a>
</h2>
<hr class="half-width">
<p>TODO: make this an info box.</p>
<p>Earlier, when setting <code>dependencies</code> in our
<code>pyproject.toml</code>, we chose to specify a minimum requirement
for <code>numpy</code>, but not for <code>pyyaml</code>:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="co"># file: pyproject.toml</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a><span class="dt">dependencies</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>    <span class="st">"numpy &gt;= 1.20"</span><span class="op">,</span></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>    <span class="st">"pyyaml"</span><span class="op">,</span></span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a><span class="op">]</span></span></code></pre>
</div>
<p>This indicates that <code>pip</code> should install any version of
<code>numpy</code> greater than 1.20, but that any version of
<code>pyyaml</code> will do. If our installed <code>numpy</code> version
is less than 1.20, or if it isn’t installed at all, <code>pip</code>
will upgrade to the latest version that’s compatible with the rest of
our installed packages and our Python version. We’ll cover software
versioning in more detail in the <a href="05-publishing.html">lesson on
publishing</a>, but now we’ll simply cover some ways to specify which
software versions we need:</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="dt">"numpy &gt;= 1.20"</span>  <span class="co"># Must be at least 1.20</span></span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a><span class="dt">"numpy &gt; 1.20"</span>   <span class="co"># Must be greater than 1.20</span></span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a><span class="dt">"numpy == 1.20"</span>  <span class="co"># Must be exactly 1.20</span></span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a><span class="dt">"numpy &lt;= 1.20"</span>  <span class="co"># Must be 1.20 at most</span></span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a><span class="dt">"numpy &lt; 1.20"</span>   <span class="co"># Must be less than 1.20</span></span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a><span class="dt">"numpy == 1.*"</span>   <span class="co"># Must be any version 1</span></span></code></pre>
</div>
<p>If we separate our clauses with commas, we can combine these
requirements:</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="co"># At least 1.20, less than 1.22, and not the release 1.21.3</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a><span class="dt">"numpy =&gt; 1.20, &lt; 1.22, != 1.21.3"</span></span></code></pre>
</div>
<p>A useful shorthand is the ‘compatible release’ clause:</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="dt">"numpy ~= 1.20"</span>  <span class="co"># Must be a release compatible with 1.20</span></span></code></pre>
</div>
<p>This is equivalent to:</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="dt">"numpy &gt;= 1.20,  == 1.*"</span></span></code></pre>
</div>
<p>That is, we require anything which is version 1, provided it’s
greater than 1.20. This would include version 1.25, but exlude version
2.0. We’ll come back to this later when we discuss <a href="05-publishing.html">publishing</a>.</p>
</section><section><h2 class="section-heading" id="optional-dependencies">Optional Dependencies<a class="anchor" aria-label="anchor" href="#optional-dependencies"></a>
</h2>
<hr class="half-width">
<p>Sometimes we might have dependencies that only make sense for certain
kind of user. For example, a developer of our library might need any
libraries we use to run unit tests or build documentation, but an end
user would not. These can be added as
<code>optional-dependencies</code>:</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="co"># file: pyproject.toml</span></span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a><span class="kw">[project.optional-dependencies]</span></span>
<span id="cb38-4"><a href="#cb38-4" tabindex="-1"></a><span class="dt">test</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb38-5"><a href="#cb38-5" tabindex="-1"></a>    <span class="st">"pytest &gt;= 5.0.0"</span><span class="op">,</span></span>
<span id="cb38-6"><a href="#cb38-6" tabindex="-1"></a><span class="op">]</span></span>
<span id="cb38-7"><a href="#cb38-7" tabindex="-1"></a><span class="dt">doc</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb38-8"><a href="#cb38-8" tabindex="-1"></a>    <span class="st">"sphinx"</span><span class="op">,</span></span>
<span id="cb38-9"><a href="#cb38-9" tabindex="-1"></a><span class="op">]</span></span></code></pre>
</div>
<p>These dependencies can be installed by adding the name of each
optional dependency group in square brackets after telling
<code>pip</code> what we want to install:</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="ex">$</span> pip install <span class="st">".[test]"</span>     <span class="co"># Include testing dependencies</span></span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a><span class="ex">$</span> pip install <span class="st">".[doc]"</span>     <span class="co"># Include documentation dependencies</span></span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a><span class="ex">$</span> pip install <span class="st">".[test,doc]"</span> <span class="co"># Include all dependencies</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>We can configure our projects for <code>pip</code> installation by
setting up a <code>pyproject.toml</code> file.</li>
<li>Simple projects require very little to be added to this file, but
there are many optional extras we can add.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-04-publishing"><p>Content from <a href="04-publishing.html">Publishing our Python Packages</a></p>
<hr>
<p>Last updated on 2024-12-10 |

        <a href="https://github.com/carpentries-incubator/python_packaging/edit/main/episodes/04-publishing.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<p>TODO: replace build and twine with hatch. local build with hatch.
demo push to test-pypi. TODO: pip install from github TODO: vcs based
versioning with git tags and hatch (like setuptools-vcs) TODO: Update
github action to use hatch and push to test-pypi TODO: Change demo
package name to <packagename>_<githubusername>, check that this does not
exist in test-pypi TODO: Create a test-pypi API token</githubusername></packagename></p>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What services can we use to publish our software?</li>
<li>What steps must we take to accomplish this?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn how to version our software and create releases.</li>
<li>Learn how to publish our software on PyPi, the Python Packaging
Index.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="publishing-our-python-packages">Publishing our Python Packages<a class="anchor" aria-label="anchor" href="#publishing-our-python-packages"></a>
</h2>
<hr class="half-width">
<p>Following our lesson on <a href="03-building-and-installing.html">building and installing</a>
Python packages, we should now have a package that can be installed
using <code>pip</code>. With just a little more work, we can now publish
our software on a few free online services: GitHub for source/version
control, and PyPI (the Python Packaging Index) for package hosting. The
latter is the default repository used by <code>pip</code>, so by hosting
our software there, other users will be able to install our software to
any machine of their choosing, and will be able to add it as a
dependency to their own projects.</p>
<p>Before discussing how to use these services, we’ll briefly cover
‘semantic versioning’: a method for adding meaningful versions to our
software containing compatibility information, and we’ll look at some of
the preparatory steps we should take before publishing our code.</p>
</section><section><h2 class="section-heading" id="versions-and-releases">Versions and Releases<a class="anchor" aria-label="anchor" href="#versions-and-releases"></a>
</h2>
<hr class="half-width">
<p>Users of our software will expect it to stay consistent over time. If
we were to suddenly rename a function, or change what arguments it
takes, this could break our user’s code, which in turn could break
another developer’s code, etc.</p>
<p>A good solution to this problem is to use ‘semantic versioning’, in
which the version number contains compatibility information in a widely
agreed-upon format. Using semanic versioning, we will periodically make
a new ‘release’ of our code, each time updating its version number, and
the way we change the number informs our users of whether the changes to
our code will break compatibility. In its most basic form, semantic
versioning requires 3 numbers, separated by periods, such as 1.2.3.
These numbers stand for MAJOR.MINOR.PATCH, and are typically updated
right-to-left. The meaning of each number is:</p>
<ul>
<li>PATCH: We increment the patch number whenever we make an update that
doesn’t add or remove functionality. It can include things such as
backwards-compatible bug fixes, internal code restructuring, and
performance improvements.</li>
<li>MINOR: The minor version should be incremented whenever we add new
backwards-compatible features to our code. This can include the addition
of new functions and classes. Whenever we increment the minor version,
the patch version is reset to zero.</li>
<li>MAJOR: The major version should be incremented whenever we make a
change that breaks backwards compatibility. This could include changing
a function name or signature, or removing something from the public API.
It can also include changing a function’s behaviour in a significant
way. Whenever we increment the major version, both the minor version and
patch version should be reset to zero.</li>
</ul>
<p>We can add a version to our code by adding a <code>__version__</code>
to our top-most <code>__init__.py</code> file:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># file: epi_models/__init__.py</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>__version__ <span class="op">=</span> <span class="st">"1.2.3"</span></span></code></pre>
</div>
<p>This should also be reflected in our <code>pyproject.toml</code>:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># file: pyproject.toml</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="kw">[project]</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="dt">version</span> <span class="op">=</span> <span class="st">"1.2.3"</span></span></code></pre>
</div>
<p>To avoid having to keep these up-to-date manually, we’ll see later
how to automatically generate version info using <code>git</code>
tags.</p>
<p>Something to note about the major and minor version numbers is that
they only need to be updated if we change the <em>public API</em> of our
software. Therefore, if we change the behaviour of any functions or
classes intended for internal use, and the public API is unchanged, we
only need to update the patch number.</p>
<div class="section level3">
<h3 id="unstable-versions">Unstable Versions<a class="anchor" aria-label="anchor" href="#unstable-versions"></a>
</h3>
<p>Software with a major version of 0 is usually understood to be
‘unstable’. This means that anything can change between minor versions,
and that no promises can be made for backwards compatibility. This is
common for software in early stages of development, as the public API
may undergo many iterations before being finalised.</p>
<p>For your own software, it may be a good idea to keep the major number
at zero while you’re hashing out the public API and building a userbase.
Once you’ve settled on a stable API, or you’ve developed a sizable
userbase that won’t appreciate having to regularly update their code to
match your changing standards, you should consider setting your version
to 1.0.0.</p>
<p>If one of the dependencies in your project is still in an unstable
state, it may be a good idea to fix the minor version number instead of
using the compatible release comparator <code>~=</code>:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="dt">dependencies</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>    <span class="st">"unstable_project &gt;= 0.6.2, == 0.6.*"</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="op">]</span></span></code></pre>
</div>
<p>This is because the <code>~= 0.6</code> will get the latest release
which is at least <code>0.6.0</code> but less than<code>1.0.0</code>,
but in this case version <code>0.7</code> might break backwards
compatibility with <code>0.6</code>. Note that some unstable projects
may also break backwards compatibiliy in their patch releases. In these
cases, it may be better to fix even the patch number:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="dt">dependencies</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>    <span class="st">"unstable_project == 0.6.2"</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="op">]</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="deprecation">Deprecation<a class="anchor" aria-label="anchor" href="#deprecation"></a>
</h3>
<p>It is considered good manners to give our users plenty of warning if
we plan to remove features that they might depend upon in our next major
release. For this reason, many developers will implement deprecation
warnings to alert users that the API is due to change in future, and
that they should update their code accordingly. For example:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="kw">def</span> myfunc():</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>    warnings.warn(</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>        <span class="st">"myfunc is deprecated, and wil be removed in version 4"</span>,</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>        <span class="pp">DeprecationWarning</span>,</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>    )</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">42</span></span></code></pre>
</div>
<p>When adding deprecations to our code, we should update the minor
version, and include them in our changelog. When we follow through on
our deprecations and remove features, this should also be clearly stated
in the changelog of our major release.</p>
</div>
<div class="section level3">
<h3 id="extra-advanced-versioning">Extra: Advanced Versioning<a class="anchor" aria-label="anchor" href="#extra-advanced-versioning"></a>
</h3>

<p>There are many more fine-grained versioning techniques that may be
employed as our projects grow in complexity, although these are not
universally adopted and may only be applicable to very large projects
with a detailed review process. The full list of version types accepted
by tools such as <code>pip</code> is listed in <a href="https://peps.python.org/pep-0440/" class="external-link">PEP 440</a>, while the formal
specification for semantic versioning can be found at <a href="https://semver.org" class="external-link">semver.org</a>. For example, we may provide
pre-release specifiers:</p>
<ul>
<li>1.1.0a0: The first alpha version of 1.1.0. This is intended for use
by developers of the project and (perhaps) a small group of users, and
may be subject to large changes. 1.1.0a0 comes after 1.0.N, but before
1.1.0. A second alpha version may be listed as 1.1.0a1.</li>
<li>1.1.0b0: The beta version of 1.1.0. This follows 1.1.0aN, and is
intended for use by a wider pool of users for further testing and
feedback. This is usually close to the finished product, but some large
changes remain possible.</li>
<li>1.1.0rc0: The release-candiate version of 1.1. Sometimes called a
‘preview’ version, it is not expected that further significant changes
will be made in version 1.1, but some small changes may be included. It
comes after 1.1.0bN, but before 1.1.0.</li>
</ul>
<p>The number following the pre-release specifier is optional, with no
number interpretted as 0 (for example, <code>1.0.0a == 1.0.0a0</code>).
A dot, hyphen, or underscore separator is also allowed, such as
<code>1.0.0-a1</code>, <code>1.1.0.beta.3</code>, or
<code>1.1.0-rc.2</code>. We may also make <em>post-releases</em> if we
wish to make minor edits after a release:</p>
<ul>
<li>1.1.0post0: An update after a release that does not change the
distributed software. For example, a change in documentation or release
notes. It comes after 1.1.0 but before 1.1.1.</li>
</ul>
<p>Similarly, post-release specifiers may have dot, hypen or underscore
separators, and may exclude the trailing number. The use of ‘rev’ or ‘r’
in place of ‘post’ is also common. Note that a post-release is
<em>not</em> the appropriate place for a quick bug fix after a full
release – that should be an update to the patch number.</p>
<p>Finally, it is possible to create local versions in cases where a
developer has made progress on a new development but has not finalised
their work in a new release. If you use a tool such as Git to control
your versioning, it may automatically generate the local version. In
general, there is no ordering to local versions. A local version is
specified with a <code>+</code> followed by a dot-separated list of
numbers, letters, and hyphens, for example <code>1.1.0+001</code> or
<code>1.2.0-alpha-630-g60eca14</code>.</p>
</div>
</section><section><h2 class="section-heading" id="preparing-to-publish">Preparing to Publish<a class="anchor" aria-label="anchor" href="#preparing-to-publish"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="readme-files">README Files<a class="anchor" aria-label="anchor" href="#readme-files"></a>
</h3>
<p>Before sharing our software with the world, it is a good idea to let
others know what it is and how it works! A good README file should
explain what a project is for, how users can install it, and how to use
it. For example, we may use the following file <code>README.md</code>,
written using markdown:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">MARKDOWN<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode markdown" tabindex="0"><code class="sourceCode markdown"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="in">    # epi_models</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="in">    A collection of Python utilities for solving epidemiology problems.</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="in">    ## Installation</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="in">    The project can be installed using \`pip\`:</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="in">    ```</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="in">    $ pip install epi_models</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="in">    ```</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="in">    To install from this repo:</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="in">    ```</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="in">    $ git clone github.com/username/learn-hatch</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="in">    $ cd epi_models</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="in">    $ pip install .</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="in">    ```</span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a><span class="in">    ## Usage</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a><span class="in">    The project offers a command line interface, which can be used as</span></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a><span class="in">    follows:</span></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a><span class="in">    ```</span></span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a><span class="in">    $ epi_models SIR input.yaml</span></span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a><span class="in">    ```</span></span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a><span class="in">    `SIR` can be exchanged for a model of your choice, and `input.yaml`</span></span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a><span class="in">    is an input file with the following entries...</span></span></code></pre>
</div>
<p>This should be included at the top level of our project:</p>
<p><code> 📁 learn-hatch<br> |<br> |____📜 pyproject.toml<br> |____📜
README.md<br>      📁 src<br>      |<br>      |____📦 epi_models<br>
          |<br>           |____📜 __init__.py<br>           |____📜
__main__.py<br>           |____📁 models<br>           |____📁
plotting<br></code></p>
<p>It should be included in our package metadata by adding the following
line in our <code>pyproject.toml</code>:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># file: pyproject.toml</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="kw">[project]</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="dt">readme</span> <span class="op">=</span> <span class="st">"README.md"</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="licensing">Licensing<a class="anchor" aria-label="anchor" href="#licensing"></a>
</h3>
<p>It is important for our software to have a license so that any
potential users know what their rights are with regards to usage and
redistribution. This can also provide us with legal protections in some
cases.</p>
<p>There are several open source licenses available, and they can be
applied to our project simply by adding a <code>LICENSE</code>,
<code>LICENSE.txt</code>, or <code>LICENSE.md</code> file to the top
level of our project:</p>
<p><code> 📁 learn-hatch<br> |<br> |____📜 pyproject.toml<br> |____📜
README.md<br> |____📜 LICENSE.md<br>      📁 src<br>      |<br>
     |____📦 epi_models<br>           |<br>           |____📜
__init__.py<br>           |____📜 __main__.py<br>           |____📁
models<br>           |____📁 plotting<br></code></p>
<p>One of the simplest and most widely used licenses is the MIT License,
which is very permissive. It requires users of your software to retain
its copyright notice if they redistribute or modify it (or ‘substantial
portions’ of it), but otherwise allows users to do what they wish. It
also ensures the author is not liable for anything the users do with
their software:</p>
<pre><code>MIT License

Copyright (c) [year] [fullname]

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.</code></pre>
<p>Information on alternative open source licenses can be found at <a href="https://choosealicense.com/" class="external-link">choosealicense.com</a>. Note that
your choice of license may be determined by your dependencies. For
example, if your code uses software licensed under the GNU GPLv3.0
license, it too should be licensed under GPLv3.0.</p>
<p>We should include our license in our <code>pyproject.toml</code> file
as follows:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="kw">[project]</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="dt">license</span> <span class="op">=</span> <span class="op">{</span><span class="dt">file</span><span class="op"> =</span> <span class="st">"LICENSE.md"</span><span class="op">}</span></span></code></pre>
</div>
<p>We can instead simply state the name of the license:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="kw">[project]</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="dt">license</span> <span class="op">=</span> <span class="op">{</span><span class="dt">text</span><span class="op"> =</span> <span class="st">"MIT License"</span><span class="op">}</span></span></code></pre>
</div>
<p>If you’re developing code on behalf of an organisation, it’s worth
checking in with their legal team (or at the very least, your
supervisor) before deciding on a license.</p>
</div>
</section><section><h2 class="section-heading" id="publishing-our-software-on-github">Publishing our Software on GitHub<a class="anchor" aria-label="anchor" href="#publishing-our-software-on-github"></a>
</h2>
<hr class="half-width">
<p><code>git</code> is a powerful version control tool that allows us to
track changes to our source code over time. This lesson is not the place
for teaching how to use <code>git</code>, but it is highly recommended
that you use it for managing your Python projects.</p>
<p>GitHub is an online service for hosting <code>git</code>-based
software projects, and it is a great way to share our code and
collaborate with others.</p>
<p>Once our code is hosted on GitHub, we can create releases and assign
them a tag. This tag should be the version number of the release. We
will see later how to use GitHub Actions to automatically publish our
code on other services whenever a new release is created.</p>
<p>Whenever we make new releases of our code, we should write a detailed
changelog that describes all of the changes since the last version. This
should include new features, bug fixes, removals, and deprecations. A
good changelog document should include all code changes in reverse
chronological order (so the latest changes should be first in the list),
and should credit anybody who contributed to the code.</p>
<p>With our code hosted on GitHub, it is possible for others to install
it using <code>pip</code>:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">$</span> pip install <span class="st">"git+https://github.com/user/project"</span></span></code></pre>
</div>
<p>However, this will simply get the latest commit to the main branch,
which may be a work-in-progress and not a true release. We can specify a
particular release by providing the version number after an
<code>@</code> sign:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">$</span> pip install <span class="st">"git+https://github.com/user/project@1.2.3"</span></span></code></pre>
</div>
<p>Note that we can also supply a branch name or a commit hash here:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">$</span> pip install <span class="st">"git+https://github.com/user/project@branch"</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="ex">$</span> pip install <span class="st">"git+https://github.com/user/project@1a2b3c4"</span></span></code></pre>
</div>
<p>Projects hosted on GitHub can also be added to dependencies in
<code>pyproject.toml</code> as so:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="dt">dependencies</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>    <span class="st">"mypkg @ git+https://github.com/user/mypkg@1.2.3"</span><span class="op">,</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="op">]</span></span></code></pre>
</div>
<p>However, it is relatively slow for <code>pip</code> to install in
this way, as it must clone the whole repository. We can instead install
from a snapshot by pointing <code>pip</code> towards an archived
<code>.zip</code>:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">$</span> pip install <span class="st">"https://github.com/user/project/archive/1.2.3.zip"</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="dt">dependencies</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>    <span class="st">"mypkg @ https://github.com/user/mypkg/archive/1.2.3.zip"</span><span class="op">,</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="op">]</span></span></code></pre>
</div>
<p>However, this is still slower than installing from a dedicated Python
package repository such as PyPI, which hosts pre-built <code>.whl</code>
files, and it only allows our users to specify a single version of our
code. This means that they may miss out on crucial patch releases. In
general, it is a good idea to use GitHub to host our source code and to
manage its development, and to use a service like PyPI to host packages
that our users can install.</p>
</section><section><h2 class="section-heading" id="extra-consistent-versioning-with-hatch-vcs">Extra: Consistent Versioning with <code>hatch-vcs</code>
<a class="anchor" aria-label="anchor" href="#extra-consistent-versioning-with-hatch-vcs"></a>
</h2>
<hr class="half-width">
<p>An issue with using GitHub to create new releases is that the project
version can easily become desynced. The version needs to be specified in
three places:</p>
<ul>
<li>
<code>git</code> tags, determined by releases on GitHub</li>
<li>The <code>version</code> field in <code>pyproject.toml</code>
</li>
<li>
<code>__version__</code> in our <code>__init__.py</code>
</li>
</ul>
<p>It is possible to have all three determined by <code>git</code> tags
using <code>hatch-vcs</code>. This can be set as a requirement of the
build system:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># file: pyproject.toml</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="co"># Build system configuration</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="kw">[build-system]</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="dt">requires</span> <span class="op">=</span> <span class="op">[</span><span class="st">"hatchling"</span><span class="op">,</span> <span class="st">"hatch-vcs"</span><span class="op">]</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="dt">build-backend</span> <span class="op">=</span> <span class="st">"hatchling.build"</span></span></code></pre>
</div>
<p>With this, we no longer need to provide an entry for
<code>project.version</code>, and instead should add:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># file: pyproject.toml</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="kw">[project]</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">"epi_models"</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a><span class="co"># version = "1.2.3" # no longer needed!</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="dt">dynamic</span> <span class="op">=</span> <span class="op">[</span><span class="st">"version"</span><span class="op">]</span></span></code></pre>
</div>
<p>Following this, we should add the following section elsewhere in
<code>pyproject.toml</code>:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># file: pyproject.toml</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="co"># Hatch versioning configuration</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="kw">[tool.hatch.version]</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="dt">source</span> <span class="op">=</span> <span class="st">"vcs"</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co"># Version control system (VCS) versioning</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="kw">[tool.hatch.version.vcs]</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="dt">tag-pattern</span> <span class="op">=</span> <span class="st">"v*"</span>  <span class="co"># Git tags starting with 'v' will be used for versioning</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="dt">fallback-version</span> <span class="op">=</span> <span class="st">"0.0.0"</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a><span class="co"># Version file location for VCS</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="kw">[tool.hatch.build.hooks.vcs]</span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a><span class="dt">version-file</span> <span class="op">=</span> <span class="st">"src/epi_models/_version.py"</span></span></code></pre>
</div>
<p>Now, when we install or build the project, <code>hatch-vcs</code>
will create a new file <code>_version.py</code> inside of our built
package. If our git tag is <code>1.2.3</code>, this will contain:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="co"># file generated by setuptools_scm</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="co"># don't change, don't track in version control</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>__version__ <span class="op">=</span> version <span class="op">=</span> <span class="st">'1.2.3'</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>__version_tuple__ <span class="op">=</span> version_tuple <span class="op">=</span> (<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span></code></pre>
</div>
<p>This can be retrieved at runtime by adding the following to
<code>__init__.py</code>:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co"># file: __init__.py</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="im">from</span> epi_models._version <span class="im">import</span> __version__</span></code></pre>
</div>
<p>Now, our Git tags, <code>__version__</code>, and
<code>pyproject.toml</code> <code>version</code> will automatically be
kept in sync.</p>
<p>We will need to add the dynamically generated
<code>_version.py</code> to our <code>.gitignore</code></p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="co"># file: .gitignore</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="ex">src/epi_models/_version.py</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="adding-git-tags">Adding git tags<a class="anchor" aria-label="anchor" href="#adding-git-tags"></a>
</h3>
<p>Before adding a new tag we should commit all our current changes and
push them to our remote repo.</p>
<p>Then we can add a new tag like so:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="co"># list tags</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="fu">git</span> tag</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a><span class="co"># Add new tag</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a><span class="fu">git</span> tag <span class="at">-a</span> 0.1.0 <span class="at">-m</span> <span class="st">"Initial minor release"</span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a><span class="co"># Push the tag to github</span></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a><span class="fu">git</span> push origin 0.1.0</span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a><span class="co"># list tags</span></span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a><span class="fu">git</span> tag</span></code></pre>
</div>
<p>Now that we have a new tag let’s re-install the package and check the
version:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-e</span> .</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a><span class="ex">epi_models</span> <span class="at">--version</span></span></code></pre>
</div>
</div>
</section><section><h2 class="section-heading" id="pypi-the-python-packaging-index">PyPI, the Python Packaging Index<a class="anchor" aria-label="anchor" href="#pypi-the-python-packaging-index"></a>
</h2>
<hr class="half-width">
<p><a href="https://pypi.org" class="external-link">PyPI</a> is the official package
repository for the Python community. It is equivalent to CRAN, used for
the R programming language. This is the repository that <code>pip</code>
uses when we install remote packages from the command line. It is
recommended to upload packages here if we want our projects to reach a
wider audience.</p>
<figure><img src="fig/pypi.png" alt="The Python Packaging Index" class="figure mx-auto d-block"><div class="figcaption">PyPI_screenshot</div>
</figure><p>To begin, you will need to create an account on <a href="https://pypi.org" class="external-link">PyPI</a> and its sister-site, <a href="https://test.pypi.org" class="external-link">TestPyPI</a> – the latter is used to check
that our packages have been uploaded and set up properly before
committing to the standard repository.</p>
<p>To help people find our project after it’s uploaded, we should add
some keywords they can search for. We can also add ‘classifiers’ that
categorise our project and describe its intended audience. A list of
possible classifiers are available on the <a href="https://pypi.org/classifiers" class="external-link">PyPI website</a>. These should be
added to our <code>pyproject.toml</code>:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="co"># file: pyproject.toml</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="kw">[project]</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a><span class="co"># keywords should contain search terms so users can</span></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a><span class="co"># find our project</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a><span class="dt">keywords</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>    <span class="st">"epimediology"</span><span class="op">,</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>    <span class="st">"virology"</span><span class="op">,</span></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>    <span class="st">"SIR"</span><span class="op">,</span></span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>    <span class="st">"SEIR"</span><span class="op">,</span></span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>    <span class="st">"Compartmental"</span><span class="op">,</span></span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a>    <span class="st">"Model"</span><span class="op">,</span></span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a><span class="op">]</span></span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a><span class="co"># Classifiers are a standard set of categories for</span></span>
<span id="cb25-17"><a href="#cb25-17" tabindex="-1"></a><span class="co"># our project, including which level of development</span></span>
<span id="cb25-18"><a href="#cb25-18" tabindex="-1"></a><span class="co"># we're at, who our intended audience is, which</span></span>
<span id="cb25-19"><a href="#cb25-19" tabindex="-1"></a><span class="co"># license we're using, etc.</span></span>
<span id="cb25-20"><a href="#cb25-20" tabindex="-1"></a><span class="dt">classifiers</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb25-21"><a href="#cb25-21" tabindex="-1"></a>    <span class="st">"Development Status :: 3 - Alpha"</span><span class="op">,</span></span>
<span id="cb25-22"><a href="#cb25-22" tabindex="-1"></a>    <span class="st">"Programming Language :: Python :: 3"</span><span class="op">,</span></span>
<span id="cb25-23"><a href="#cb25-23" tabindex="-1"></a>    <span class="st">"Intended Audience :: Science/Research"</span><span class="op">,</span></span>
<span id="cb25-24"><a href="#cb25-24" tabindex="-1"></a>    <span class="st">"Topic :: Scientific/Engineering :: Bio-Informatics"</span><span class="op">,</span></span>
<span id="cb25-25"><a href="#cb25-25" tabindex="-1"></a>    <span class="st">"License :: OSI Approved :: MIT License"</span><span class="op">,</span></span>
<span id="cb25-26"><a href="#cb25-26" tabindex="-1"></a><span class="op">]</span></span></code></pre>
</div>
<p>Before discussing how to get our project hosted on PyPI, we’ll
quickly discuss ‘wheel’ files, which are the standard way for Python to
distribute packages.</p>
</section><section><h2 class="section-heading" id="wheel-files">Wheel files<a class="anchor" aria-label="anchor" href="#wheel-files"></a>
</h2>
<hr class="half-width">
<p>When we install packages using <code>pip</code>, it first creates a
‘wheel’ file, with the file extension <code>.whl</code>. For
example:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="ex">$</span> cd epi_models</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="ex">$</span> pip install .</span></code></pre>
</div>
<pre class="result"><code>... installs dependencies ...

Building wheels for collected packages: epi-models
  Building wheel for epi-models (pyproject.toml) ... done
  Created wheel for epi-models: filename=epi_models-0.1.0-py3-none-any.whl size=5378 sha256=005bcad72e7f6cc773f4180960e402e3bdbdf0fcb6fb683a019d9521775edfc8
  Stored in directory: /tmp/pip-ephem-wheel-cache-69r0h48p/wheels/d9/4d/ac/bbc1437fd83635787dd0fb8c3df8da61fc7b57f6eaa2b0d17b
Successfully built epi-models
Installing collected packages: epi-models
Successfully installed epi-models-0.1.0</code></pre>
<p>The installation goes through several steps:</p>
<ul>
<li>
<code>pip</code> analyses our package and creates a
<code>.whl</code> file.</li>
<li>The <code>.whl</code> file is stored in a temporary directory.</li>
<li>The package is installed to our system from the <code>.whl</code>
file.</li>
</ul>
<p>After installation, we can find our installed package at
<code>/path/to/my/env/lib/python3.8/site-packages/epi_models</code>, and
within we’ll find that every file has been compiled to Python bytecode,
contained within <code>__pycache__</code> directories. So what is a
wheel file, and how does it help with this process?</p>
<p>A wheel is a standard package distribution format, defined in <a href="https://peps.python.org/pep-0427/" class="external-link">PEP 427</a>. It is essentially
a <code>.zip</code> file with a descriptive name that contains our
package. When we installed our package above it created the following
wheel file:</p>
<pre><code>epi_models-0.1.0-py3-none-any.whl</code></pre>
<p>The filename has seveal components separated by dashes. In order,
these are:</p>
<ul>
<li>The package name</li>
<li>The package version</li>
<li>Language implementation, such as <code>py3</code>,
<code>py27</code>, or <code>py2</code>. Packages that are compatible
with any Python version will be <code>py2.py3</code>. Packages that are
only compatible with a particular Python implementation, such as
CPython, may be listed <code>cpy38</code>.</li>
<li>The ABI tag, which stands for ‘Application Binary Interface’. This
specifies the binary compatibility of the CPython API, and may take a
value such as <code>abi3</code>. This won’t be relevant unless you’re
distributing compiled extensions written in C, and will be
<code>none</code> if your package is pure Python. This is beyond the
scope of these lessons.</li>
<li>Platform tag, which specifies which operating system your package is
compatible with. <code>any</code> means it will run on Windows, Mac or
Linux, while it may say something like <code>macosx_10_9_x86_64</code>
if it includes compiled C extensions for Mac OSX 10.9 on an x86_64
architecture. The <code>manylinux</code> tag encompasses many different
popular Linux distros.</li>
</ul>
<p>When we upload our package to PyPI, we will do so in the form of a
wheel file, which contains all Python files in our package along with
any compiled binaries for extensions written in C. When a wheel file is
installed, Python files are compiled to bytecode, and the package is
installed to the <code>site-packages</code> of our environment.</p>
<p>As the wheel file contains compatibility information in its name,
<code>pip</code> can quickly check to see whether any wheels uploaded to
PyPI are compatible with our system whenever we try to install
something. In order to meet the needs of as many users as possible, it’s
also possible for us to upload multiple wheels for each release – one
for each targeted Python version and operating system.</p>
</section><section><h2 class="section-heading" id="hatch-build">
<code>hatch build</code><a class="anchor" aria-label="anchor" href="#hatch-build"></a>
</h2>
<hr class="half-width">
<p>So how do we create a wheel file to upload? The Hatch library can be
used to build and publish wheels.</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="ex">$</span> pip install hatch</span></code></pre>
</div>
<p>As we already have a <code>pyproject.toml</code>, <code>build</code>
has everything it needs to create a wheel file. It can be called simply
using:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="ex">$</span> hatch build</span></code></pre>
</div>
<p>This will create a new directory <code>./dist</code> containing the
following:</p>
<p><code> 📁 dist<br> |<br> |____📜
epi_models-0.1.0-py3-none-any.whl<br> |____📜
epi_models-0.1.0.tar.gz<br></code></p>
<p>We can see the contents of the <code>.whl</code> file by unzipping
it:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="ex">$</span> cd dist</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a><span class="ex">$</span> unzip dist/epi_models-0.1.0-py3-none-any.whl</span></code></pre>
</div>
<p>We’ll see that it contains our package along with a second directory
<code>epi_models-0.1.0.dist-info</code>, which contains package metadata
such as our license and README file. Note that we should remove the
unzipped directories from <code>./dist</code> before the upload
stage.</p>
<p>The second file <code>hatch build</code> created is a
<code>.tar.gz</code> file – a gzip-compressed tarball. This is a ‘source
distribution’, which is used as a backup by <code>pip</code> if it can’t
find a suitable wheel file to install.</p>
<div class="section level3">
<h3 id="publish-wheels-to-test-pypi">Publish Wheels to test-pypi<a class="anchor" aria-label="anchor" href="#publish-wheels-to-test-pypi"></a>
</h3>
<p>The tool for uploading our package to PyPI is
<code>hatch publish</code>.</p>
<p>Note: before we upload our package we will need to make sure we are
using unique package names.</p>
<p>Change you package name from to
<code>githubusername-epi_modules</code>.</p>
<p>You will need to change the package name in the following locations:
- pyproject.toml - project.name - project.scripts entrypoint - The
<code>src/epi_models</code> dir - Any relative imports in the
modules</p>
<p>Test that the package can still be installed.</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="ex">pip</span> uninstall epi_modules</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-e</span> .</span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a><span class="ex">epi_modules</span> <span class="at">--version</span></span></code></pre>
</div>
<p>Lets commit those changes and add a new tag.</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="co"># list tags</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a><span class="fu">git</span> tag</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a><span class="co"># Add new tag</span></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a><span class="fu">git</span> tag <span class="at">-a</span> 0.1.1 <span class="at">-m</span> <span class="st">"Edit package name"</span></span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a><span class="co"># Push the tag to github</span></span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a><span class="fu">git</span> push origin 0.1.1</span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a><span class="co"># list tags</span></span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a><span class="fu">git</span> tag</span></code></pre>
</div>
<p>We can test the distribution of our package by uploading to
TestPyPI.</p>
<p>First we will need to create a “token” on test-pypi to use as a
temporary password.</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="ex">$</span> hatch publish <span class="at">--repo</span> testpypi <span class="at">--user</span> __token__ <span class="at">--auth</span> <span class="op">&lt;</span>your_token_here<span class="op">&gt;</span></span></code></pre>
</div>
<p>To avoid entering you token on the cmd line you can provide details
as env variables</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="bu">export</span> <span class="va">HATCH_INDEX_USER</span><span class="op">=</span>__token__ </span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a><span class="bu">export</span> <span class="va">HATCH_INDEX_AUTH</span><span class="op">=&lt;</span>your-token<span class="op">&gt;</span></span></code></pre>
</div>
<p>For more authentication options see the <a href="https://hatch.pypa.io/latest/how-to/publish/auth/" class="external-link">Hatch
documentation</a>.</p>
<p>Note that there is a registration process for TestPyPI, and a
separate one for PyPI.</p>
<p>Once uploaded to TestPyPI we can check that everything looks correct
using the web interface.</p>
<p>If you choose to <code>pip</code> download from TestPyPI you may need
to specify that the dependencies are gotten from PyPI proper by using
the <code>--extra-indec-url</code> flag. This is because the
dependencies may not be available through TestPyPI.</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="ex">$.</span> pip install <span class="at">-i</span> https://test.pypi.org/pypi/ <span class="at">--extra-index-url</span> https://pypi.org/simple githubusername-epi_models==0.1.0</span></code></pre>
</div>
<p>The process is the same for publishing to PyPi (but please don’t
publish this test project!).</p>
<p>Users will then be able to install our package to any machine by
calling the following:</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="ex">$</span> pip install epi_models</span></code></pre>
</div>
<p>Similarly, it can be included as a dependency to other Python
projects:</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="co"># file: pyproject.toml</span></span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a><span class="kw">[project]</span></span>
<span id="cb38-4"><a href="#cb38-4" tabindex="-1"></a><span class="dt">dependencies</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb38-5"><a href="#cb38-5" tabindex="-1"></a>    <span class="st">"epi_models"</span><span class="op">,</span></span>
<span id="cb38-6"><a href="#cb38-6" tabindex="-1"></a><span class="op">]</span></span></code></pre>
</div>
<p>As we continue to develop our software, we should upload each new
version to PyPI. Our users will then be able to request a particular
version:</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="co"># file: pyproject.toml</span></span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a><span class="kw">[project]</span></span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a><span class="dt">dependencies</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb39-5"><a href="#cb39-5" tabindex="-1"></a>    <span class="st">"epi_models ~= 1.2"</span><span class="op">,</span></span>
<span id="cb39-6"><a href="#cb39-6" tabindex="-1"></a><span class="op">]</span></span></code></pre>
</div>
</div>
</section><section><h2 class="section-heading" id="extra-automating-package-publishing-with-github-actions">Extra: Automating Package Publishing with GitHub Actions<a class="anchor" aria-label="anchor" href="#extra-automating-package-publishing-with-github-actions"></a>
</h2>
<hr class="half-width">
<p>We saw earlier how to ensure that the version of our package was
stored only in the Git tags. We can similarly set up our GitHub project
to automatically publish our package whenever we make a new release. We
can use GitHub Actions for this, which is a service used for continuous
integration. It can achieve tasks such as:</p>
<ul>
<li>Automatically run tests on a variety of platforms each time a new
commit is pushed or version is published.</li>
<li>Enforce a code style automatically.</li>
<li>Publish work on each release.</li>
</ul>
<p>GitHub Actions are controlled using a YAML file. Though the full
specification is beyond the scope of this course, the following file
will cause GitHub to automatically upload our package to PyPI with each
new release:</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="co"># Provide a name for the workflow</span></span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Upload Python Package</span></span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a><span class="co"># Tell GitHub when to run the action</span></span>
<span id="cb40-5"><a href="#cb40-5" tabindex="-1"></a><span class="co"># This will run every time a new release is published</span></span>
<span id="cb40-6"><a href="#cb40-6" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb40-7"><a href="#cb40-7" tabindex="-1"></a><span class="at">  </span><span class="fu">release</span><span class="kw">:</span></span>
<span id="cb40-8"><a href="#cb40-8" tabindex="-1"></a><span class="at">    </span><span class="fu">types</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">published</span><span class="kw">]</span></span>
<span id="cb40-9"><a href="#cb40-9" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb40-11"><a href="#cb40-11" tabindex="-1"></a><span class="at">  </span><span class="fu">deploy</span><span class="kw">:</span></span>
<span id="cb40-12"><a href="#cb40-12" tabindex="-1"></a><span class="co">    # Run the workflow on the latest Ubuntu version</span></span>
<span id="cb40-13"><a href="#cb40-13" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb40-14"><a href="#cb40-14" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb40-15"><a href="#cb40-15" tabindex="-1"></a><span class="co">      # This will checkout our GitHub project and enter</span></span>
<span id="cb40-16"><a href="#cb40-16" tabindex="-1"></a><span class="co">      # the directory</span></span>
<span id="cb40-17"><a href="#cb40-17" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v3</span></span>
<span id="cb40-18"><a href="#cb40-18" tabindex="-1"></a><span class="co">      # This will set up a Python environment</span></span>
<span id="cb40-19"><a href="#cb40-19" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up Python</span></span>
<span id="cb40-20"><a href="#cb40-20" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/setup-python@v4</span></span>
<span id="cb40-21"><a href="#cb40-21" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb40-22"><a href="#cb40-22" tabindex="-1"></a><span class="at">          </span><span class="fu">python-version</span><span class="kw">:</span><span class="at"> </span><span class="st">'3.x'</span></span>
<span id="cb40-23"><a href="#cb40-23" tabindex="-1"></a><span class="co">      # Here we update pip to the latest version and</span></span>
<span id="cb40-24"><a href="#cb40-24" tabindex="-1"></a><span class="co">      # install 'hatch'</span></span>
<span id="cb40-25"><a href="#cb40-25" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install dependencies</span></span>
<span id="cb40-26"><a href="#cb40-26" tabindex="-1"></a><span class="fu">        run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb40-27"><a href="#cb40-27" tabindex="-1"></a>          python -m pip install --upgrade pip</span>
<span id="cb40-28"><a href="#cb40-28" tabindex="-1"></a>          pip install hatch</span>
<span id="cb40-29"><a href="#cb40-29" tabindex="-1"></a><span class="co">      # Here we run build to create a wheel and a</span></span>
<span id="cb40-30"><a href="#cb40-30" tabindex="-1"></a><span class="co">      # .tar.gz source distribution.</span></span>
<span id="cb40-31"><a href="#cb40-31" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build package</span></span>
<span id="cb40-32"><a href="#cb40-32" tabindex="-1"></a><span class="at">        </span><span class="fu">run</span><span class="kw">:</span><span class="at"> hatch build</span></span>
<span id="cb40-33"><a href="#cb40-33" tabindex="-1"></a><span class="co">      # Finally, we use a pre-defined action to publish</span></span>
<span id="cb40-34"><a href="#cb40-34" tabindex="-1"></a><span class="co">      # our package </span></span>
<span id="cb40-35"><a href="#cb40-35" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Publish package</span></span>
<span id="cb40-36"><a href="#cb40-36" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> pypa/gh-action-pypi-publish@release/v1</span></span>
<span id="cb40-37"><a href="#cb40-37" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb40-38"><a href="#cb40-38" tabindex="-1"></a><span class="at">          </span><span class="fu">user</span><span class="kw">:</span><span class="at"> __token__</span></span>
<span id="cb40-39"><a href="#cb40-39" tabindex="-1"></a><span class="at">          </span><span class="fu">password</span><span class="kw">:</span><span class="at"> ${{ secrets.PYPI_API_TOKEN }}</span></span></code></pre>
</div>
<p>This should be included in the file
<code>.github/workflows/publish.yml</code>, where the
<code>.github</code> directory is located at the top level of our
project (at the same level as <code>pyproject.toml</code>). In order for
this to work, we’ll need to set up a <code>PYPI_DEPLOYMENT_TOKEN</code>
in the ‘secrets’ section of our project’s GitHub settings. A guide to
doing this may be found on the <a href="https://pypi.org/help/#apitoken" class="external-link">PyPI website</a>.</p>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>You should <em>never</em> push sensitive information such as
passwords directly to your GitHub projects!</p>
</div>
</div>
</div>
<p>With this set up, our projects will be automatically pushed to PyPI
each time we make a new release.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Versioning our projects is important so that our users know what’s
compatible.</li>
<li>GitHub is a powerful service for hosting our projects and managing
their development.</li>
<li>Each new release of our packages should be uploaded to PyPI using
<code>hatch build</code> and <code>hatch publish</code>.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/carpentries-incubator/python_packaging/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/carpentries-incubator/python_packaging/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/carpentries-incubator/python_packaging/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries-incubator/python_packaging/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:liam.pattinson@york.ac.uk">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper" class="external-link">sandpaper (0.16.10.9000)</a>, <a href="https://github.com/carpentries/pegboard" class="external-link">pegboard (0.7.7.9000)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.5" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries-incubator.github.io/python_packaging/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://carpentries-incubator.github.io/python_packaging/aio.html",
  "identifier": "https://carpentries-incubator.github.io/python_packaging/aio.html",
  "dateCreated": "2024-12-10",
  "dateModified": "2024-12-17",
  "datePublished": "2024-12-17"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

